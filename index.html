<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Favicon optimizado -->
    <link rel="icon" type="image/png" href="images/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="images/favicon/favicon.svg" />
    <link rel="shortcut icon" href="images/favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="images/favicon/apple-touch-icon.png" />
    <link rel="manifest" href="images/favicon/site.webmanifest" />

    <!-- Meta Description mejorada -->
    <meta name="description" content="El Oso es una cervecería artesanal de Quilmes, Buenos Aires. Hacemos cervezas artesanales en lotes limitados, salsas picantes y conservas sin conservantes ni químicos. Venta directa y envíos a toda Argentina.">

    <!-- Keywords para SEO -->
    <meta name="keywords" content="cerveza artesanal quilmes, cervecería artesanal buenos aires, cerveza artesanal argentina, cervezas artesanales, salsas picantes artesanales, conservas artesanales, el oso cervecería">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://eloso.ar/">

    <!-- Open Graph mejorado -->
    <meta property="og:title" content="El Oso | Cerveza Artesanal, Picantes y Conservas">
    <meta property="og:description" content="Cervezas artesanales en lotes limitados, picantes y conservas hechas a mano. Sin conservantes ni químicos. Desde Quilmes a toda Argentina.">
    <meta property="og:image" content="https://eloso.ar/images/logo/logo-blanco.png?v=15">
    <meta property="og:url" content="https://eloso.ar/">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="es_AR">
    <meta property="og:site_name" content="El Oso Cerveza Artesanal">

    <!-- Geo Tags -->
    <meta name="geo.region" content="AR-B">
    <meta name="geo.placename" content="Buenos Aires">
    <meta name="geo.position" content="-34.6037;-58.3816">
    <meta name="ICBM" content="-34.6037, -58.3816">

    <!-- Author -->
    <meta name="author" content="El Oso">

    <!-- Robots mejorado -->
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    
    <!-- Preconnect optimizado -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://wa.me">
    <link rel="preconnect" href="https://www.clarity.ms">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">

    <!-- Preload para imágenes críticas -->
    <link rel="preload" href="images/logo/logo-64x64.png" as="image">

    <title>El Oso</title>
    
    <!-- Estilos principales -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css">
    <style>
        /* Estilos generales */
        :root {
            --color-black: #000000;
            --color-white: #ffffff;
            --color-gray: #efece9;
            --color-accent: #ffffff;
            --color-red: #ff3131;
            --color-accent-2: #efece9;
            --font-primary: 'Helvetica Neue', Arial, sans-serif;
            --font-ticket: 'Courier New', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-primary);
            background-color: var(--color-black);
            color: var(--color-white);
            overflow-x: hidden;
            line-height: 1.6;
        }

        a {
            color: var(--color-white);
            text-decoration: none;
            transition: color 0.3s;
        }

        a:hover {
            color: var(--color-accent);
        }

        button {
            cursor: pointer;
            border: none;
            background: none;
            font-family: inherit;
        }

        img {
            max-width: 100%;
            height: auto;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Mantener el resto de estilos existentes */
        #main-wrapper {
            margin-left: 80px;
            transition: margin-left 0.3s;
            position: relative;
            z-index: 1;
        }

        #main-header {
            padding-left: 80px;
            transition: padding-left 0.3s;
        }

        #main-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            padding: 20px 0;
        }

        .main-header--container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 40px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 40px;
        }

        .header-left nav {
            display: flex;
            gap: 25px;
        }

        .header-left nav a {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .top-menu {
            display: flex;
            align-items: center;
            gap: 20px;
            position: relative;
        }

        .social {
            display: flex;
            gap: 15px;
        }

        .social a {
            font-size: 0.9rem;
            font-weight: bold;
        }

        .header-right .logo {
            display: block;
            width: 60px;
            height: 60px;
            background-image: url('images/logo/logo-64x64.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .home-hero {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .home-hero .bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.7;
        }

        .home-hero--content {
            text-align: center;
            z-index: 1;
            max-width: 800px;
            padding: 40px;
            border-radius: 10px;
        }

        .home-hero--content .logo {
            width: 200px;
            margin: 0 auto 30px;
            display: block;
        }

        .home-hero--text h1 {
            font-size: 2rem;
            margin-bottom: 40px;
            line-height: 1.4;
        }

        .home-hero--text h1 span {
            display: block;
            font-size: 1.5rem;
            margin-top: 15px;
            font-style: italic;
        }

        .home-hero--content input[type="email"] {
            width: 100%;
            max-width: 400px;
            padding: 15px 20px;
            background: transparent;
            border: 1px solid var(--color-white);
            color: var(--color-white);
            border-radius: 30px;
            margin-bottom: 20px;
            font-size: 1rem;
        }

        .home-hero--content button {
            background-color: var(--color-white);
            color: var(--color-black);
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1rem;
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.3s;
        }

        .home-hero--content button:hover {
            background-color: var(--color-accent);
            color: var(--color-white);
        }

        .home-section {
            padding: 100px 0;
            display: flex;
            align-items: center;
        }

        .home-section--left {
            flex: 1;
            padding-right: 40px;
        }

        .home-section--right {
            width: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .home-section--header {
            margin-bottom: 30px;
        }

        .home-section--header h1 {
            font-size: 4rem;
            margin-bottom: 30px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn-white-border {
            border: 1px solid var(--color-white);
            color: var(--color-white);
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
        }

        .btn-white-border:hover,
        .btn-white-border.active {
            background-color: var(--color-white);
            color: var(--color-black);
        }

        .btn-add-cart {
            border: 1px solid var(--color-accent);
            color: var(--color-accent);
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            display: inline-block;
            margin-top: 10px;
            width: 100%;
        }

        .btn-add-cart:hover,
        .btn-add-cart.added {
            background-color: var(--color-accent);
            color: var(--color-black);
        }

        /* ====== NUEVO ESTILO PARA GRID DE PRODUCTOS ====== */
        .products-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            margin-top: 40px;
        }

        .shop-article {
            border-radius: 10px;
            transition: transform 0.3s;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .shop-article:hover {
            transform: translateY(-10px);
        }

        .shop-article--image {
            margin-bottom: 20px;
            overflow: hidden;
            border-radius: 5px;
            position: relative;
        }

        .shop-article--image img {
            width: 100%;
            transition: transform 0.5s;
            background-color: var(--color-white);
            cursor: pointer;
        }

        .shop-article:hover .shop-article--image img {
            transform: scale(1.05);
        }

        .shop-article--title {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .shop-article--info {
            font-size: 0.9rem;
            color: #aaa;
            margin-bottom: 15px;
        }

        .shop-article--precio {
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .shop-article--precio b {
            font-size: 1.2rem;
            color: var(--color-white);
        }

        /* ====== NUEVO: CONTROLES DE CANTIDAD EN LISTADO ====== */
        .shop-article--quantity {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quantity-label {
            font-size: 0.9rem;
            color: #aaa;
        }

        .quantity-controls-list {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 10px;
            border-radius: 20px;
            justify-content: space-between;
            width: 100%;
        }

        .quantity-btn-list {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--color-black);
            color: var(--color-white);
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 1rem;
            border: none;
        }

        .quantity-btn-list:hover {
            background: var(--color-black);
            color: var(--color-white);
            border: 1px solid var(--color-white);
        }

        .quantity-display-list {
            min-width: 30px;
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
        }

        .product-inactive {
            opacity: 0.6;
            position: relative;
        }

        .product-inactive::after {
            content: "NO DISPONIBLE";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-15deg);
            background-color: rgba(0, 0, 0, 0.8);
            color: #fff;
            padding: 10px 20px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 5px;
            z-index: 2;
            pointer-events: none;
        }

        /* ====== MODAL PARA DETALLES DEL PRODUCTO ====== */
        .product-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2001;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .product-modal-overlay.active {
            display: flex;
        }

        .product-modal {
            background: var(--color-white);
            color: var(--color-black);
            border-radius: 15px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow: hidden;
            position: relative;
            margin: 20px;
            overflow-y: auto;
        }

        .product-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--color-black);
            color: var(--color-white);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            z-index: 10;
            border: 2px solid var(--color-white);
            transition: all 0.3s;
        }

        .product-modal-close:hover {
            background: var(--color-accent);
            transform: rotate(90deg);
        }

        .product-modal-content {
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        @media (min-width: 992px) {
            .product-modal-content {
                flex-direction: row;
            }
        }

        .product-modal-image {
            flex: 1;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            min-height: 300px;
        }

        .product-modal-image img {
            max-height: 400px;
            object-fit: contain;
        }

        .product-modal-info {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .product-modal-title {
            font-size: 2.2rem;
            margin-bottom: 10px;
            color: var(--color-black);
        }

        .product-modal-subtitle {
            font-size: 1.1rem;
            color: #666;
            margin-bottom: 20px;
            font-style: italic;
        }

        .product-modal-price {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--color-black);
            margin-bottom: 25px;
        }

        .product-modal-price b {
            font-size: 2rem;
        }

        .product-modal-description {
            font-size: 1rem;
            line-height: 1.7;
            color: #444;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .product-modal-details {
            margin-bottom: 30px;
        }

        .product-modal-detail-row {
            display: flex;
            margin-bottom: 10px;
        }

        .product-modal-detail-label {
            flex: 0 0 120px;
            font-weight: bold;
            color: #333;
        }

        .product-modal-detail-value {
            flex: 1;
            color: #666;
        }

        /* Cantidad en modal */
        .product-modal-quantity {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .product-modal-quantity .quantity-label {
            color: #333;
            font-weight: bold;
        }

        .product-modal-quantity .quantity-controls-list {
            background: #f0f0f0;
        }

        /* Botón en modal */
        .product-modal-btn {
            width: 100%;
            padding: 16px;
            background: var(--color-black);
            color: var(--color-white);
            border: none;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .product-modal-btn:hover {
            background: #333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .product-modal-btn.added {
            background: #4CAF50;
            color: white;
        }

        /* Estilos para reseñas */
        .review-card {
            background-color: var(--color-white);
            border-radius: 10px;
            padding: 30px;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s;
            margin-bottom: 20px;
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .reviewer-info {
            flex: 1;
        }

        .reviewer-name {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: #222;
        }

        .reviewer-details {
            font-size: 0.85rem;
            color: #555;
            margin-bottom: 8px;
        }

        .review-date {
            font-size: 0.8rem;
            color: #666;
        }

        .review-stars {
            display: flex;
            gap: 3px;
            margin-bottom: 10px;
        }

        .star {
            color: #FFD700;
            font-size: 1rem;
        }

        .review-content {
            flex: 1;
            line-height: 1.6;
            font-size: 0.95rem;
            color: #333;
        }

        .reviews-button {
            background-color: var(--color-black);
            color: var(--color-white);
            border: 1px solid var(--color-white);
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .reviews-button:hover {
            background-color: var(--color-white);
            transform: translateY(-2px);
            color: var(--color-black);
        }

        .card-somos {
            display: flex;
            gap: 40px;
            margin-bottom: 60px;
        }

        .card-somos--left {
            flex: 1;
        }

        .card-somos--content h5 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--color-accent);
        }

        .card-somos--text div {
            margin-bottom: 20px;
            line-height: 1.8;
        }

        .card-somos--text small {
            display: block;
            font-style: italic;
            color: #aaa;
        }

        .card-somos--right {
            flex: 1;
            overflow: hidden;
            border-radius: 10px;
        }

        .card-somos--right img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-contacto {
            display: flex;
            gap: 40px;
        }

        .card-contacto--left {
            flex: 1;
        }

        .card-contacto--left h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--color-accent);
        }

        .contacto-row {
            display: flex;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }

        .contacto-row--left {
            flex: 1;
            font-weight: bold;
        }

        .card-contacto--right {
            flex: 1;
            overflow: hidden;
            border-radius: 10px;
        }

        .card-contacto--right img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #main-footer {
            background-color: #111;
            padding: 60px 0 30px;
            position: relative;
            z-index: 1001;
            margin-left: 80px;
            transition: margin-left 0.3s;
        }

        .main-footer--top {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 60px;
        }

        .columna h4 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--color-accent);
        }

        .columna nav {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .columna-logo img {
            width: 100px;
        }

        .main-footer--bottom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .main-footer--bottom form {
            display: flex;
            gap: 15px;
        }

        .main-footer--bottom input[type="email"] {
            padding: 12px 20px;
            background: transparent;
            border: 1px solid var(--color-white);
            color: var(--color-white);
            border-radius: 30px;
            min-width: 300px;
        }

        .main-footer--bottom button {
            background-color: var(--color-white);
            color: var(--color-black);
            padding: 12px 30px;
            border-radius: 30px;
            font-weight: bold;
        }

        #main-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 80px;
            background-color: var(--color-black);
            z-index: 1002;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 30px 0;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .main-sidebar--logo {
            margin-bottom: 60px;
        }

        .main-sidebar--logo img {
            width: 40px;
        }

        .main-sidebar--nav {
            display: flex;
            flex-direction: column;
            gap: 30px;
            flex: 1;
        }

        .main-sidebar--nav a {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .main-sidebar--nav a.active {
            color: var(--color-accent);
        }

        .main-sidebar--login {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .swiper {
            width: 100%;
            height: 100%;
        }

        .swiper-button-next,
        .swiper-button-prev {
            color: var(--color-white) !important;
            width: 50px !important;
            height: 50px !important;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
        }

        .swiper-button-next:hover,
        .swiper-button-prev:hover {
            background-color: rgba(0, 0, 0, 0.5);
            transform: scale(1.1);
        }

        .swiper-button-next:after,
        .swiper-button-prev:after {
            font-weight: bold;
        }

        /* Agrega esto después de los estilos de swiper-button-next/prev: */
        .swiper-button-next {
            right: 20px !important;
        }

        .swiper-button-prev {
            left: 20px !important;
        }

        /* Para posicionar los botones en la parte inferior */
        .mySwiperReviews,
        .mySwiper3,
        .mySwiper4 {
            position: relative;
            padding-bottom: 60px;
        }

        .mySwiperReviews .swiper-button-next,
        .mySwiperReviews .swiper-button-prev,
        .mySwiper3 .swiper-button-next,
        .mySwiper3 .swiper-button-prev,
        .mySwiper4 .swiper-button-next,
        .mySwiper4 .swiper-button-prev {
            top: auto !important;
            bottom: 0 !important;
            margin-top: 0;
        }

        /* ====== NUEVO CARRITO - ESTILO TICKET DE BAR ====== */
        .cart-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1999;
        }

        .cart-overlay.active {
            display: block;
        }

        .cart-sidebar {
            position: fixed;
            top: 0;
            right: -420px;
            width: 420px;
            height: 100vh;
            color: #000;
            z-index: 2000;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: #efece9;
        }

        .cart-sidebar.active {
            right: 0;
        }

        .cart-ticket {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .ticket-header {
            padding: 20px;
            position: relative;
        }

        .ticket-header h2 {
            font-size: 1.4rem;
            margin: 0;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .ticket-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-top: 5px;
        }

        .close-cart {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            line-height: 1;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ticket-body {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #fff;
        }

        .continue-shopping {
            display: block;
            text-align: center;
            padding: 12px;
            background: var(--color-accent);
            color: var(--color-black);
            font-weight: bold;
            border-radius: 4px;
            margin-bottom: 20px;
            font-family: var(--font-primary);
            transition: background 0.3s;
        }

        .continue-shopping:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .ticket-section {
            margin-bottom: 20px;
            border-bottom: 1px dashed #ccc;
            padding-bottom: 20px;
        }

        .ticket-section:last-child {
            border-bottom: none;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
            color: #333;
            border-bottom: 2px solid #333;
            padding-bottom: 5px;
        }

        /* Estilo de ítems del carrito */
        .ticket-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .ticket-item:last-child {
            border-bottom: none;
        }

        .item-info {
            flex: 1;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 5px;
        }

        .item-name {
            font-size: 1rem;
            color: #333;
        }

        .item-price {
            color: #333;
            white-space: nowrap;
        }

        .item-details {
            font-size: 0.9rem;
            color: #666;
        }

        .item-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 20px;
        }

        .quantity-btn {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #333;
            color: white;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.3s;
            font-size: 1rem;
        }

        .quantity-btn:hover {
            background: #666;
        }

        .quantity-display {
            min-width: 30px;
            text-align: center;
            font-weight: bold;
            font-size: 1rem;
        }

        .remove-item {
            color: #666;
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.3s;
            font-weight: bold;
        }

        .remove-item:hover {
            color: #333;
            text-decoration: underline;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 0.95rem;
        }

        .summary-row:not(:last-child) {
            border-bottom: 1px dotted #ccc;
        }

        .summary-row.total {
            font-weight: bold;
            font-size: 1.2rem;
            border-top: 2px solid #333;
            padding-top: 15px;
            margin-top: 10px;
            border-bottom: none;
        }

        .summary-row.shipping {
            border-bottom: none;
        }

        /* Estilos para los selects de envío */
        .shipping-form-group {
            margin-bottom: 20px;
        }

        .shipping-form-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95rem;
        }

        .shipping-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--color-black);
            border-radius: 6px;
            background-color: var(--color-black);
            font-size: 0.95rem;
            color: var(--color-white);
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%23333' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
            cursor: pointer;
            transition: border-color 0.3s;
            text-transform: uppercase;
        }

        .shipping-select:focus {
            outline: none;
            border-color: #666;
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
        }

        .shipping-select option {
            padding: 10px;
        }

        /* Información de envío */
        .shipping-info {
            background: #fff8f8;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #ffcccc;
        }

        .shipping-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .shipping-title {
            font-weight: bold;
            font-size: 0.95rem;
            color: #333;
        }

        .shipping-change {
            color: #666;
            font-size: 0.85rem;
            cursor: pointer;
            font-weight: bold;
        }

        .shipping-change:hover {
            color: #333;
            text-decoration: underline;
        }

        .shipping-details {
            font-size: 0.85rem;
            color: #666;
            line-height: 1.4;
        }

        .shipping-warning {
            font-size: 0.8rem;
            color: #ff3131;
            margin-top: 10px;
            font-style: italic;
            background: #fff0f0;
            padding: 8px;
            border-radius: 4px;
        }

        /* Opciones de envío */
        .shipping-options {
            display: none;
            margin: 15px 0;
        }

        .shipping-option {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shipping-option:hover {
            border-color: #666;
        }

        .shipping-option.selected {
            border-color: #333;
            background: #f5f5f5;
        }

        .shipping-option input {
            margin-right: 10px;
        }

        .shipping-option-content {
            flex: 1;
        }

        .shipping-option-title {
            font-weight: bold;
            font-size: 0.95rem;
            margin-bottom: 3px;
        }

        .shipping-option-details {
            font-size: 0.85rem;
            color: #666;
        }

        .shipping-option-price {
            font-weight: bold;
            color: #333;
            font-size: 0.95rem;
        }

        /* Cupón y envío gratis */
        .coupon-section {
            margin: 15px 0;
        }

        .coupon-form {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .coupon-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .coupon-btn {
            padding: 10px 15px;
            background: #333;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .coupon-btn:hover {
            background: #444;
        }

        .free-shipping-notice {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 10px;
            border-radius: 4px;
            margin: 15px 0;
            font-size: 0.9rem;
            text-align: center;
            font-weight: bold;
        }

        /* Método de pago */
        .payment-method {
            background: #f0f0f0;
            padding: 12px;
            border-radius: 4px;
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            margin: 15px 0;
            border: 1px dashed #ccc;
        }

        /* Botón de pedir - MEJORADO */
        .checkout-btn {
            width: 100%;
            padding: 18px;
            background: var(--color-black);
            color: var(--color-white);
            border: none;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-family: var(--font-primary);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .checkout-btn:hover:not(:disabled) {
            background: var(--color-white);
            border: 1px solid var(--color-black);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            color: var(--color-black);
        }

        .checkout-btn:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .checkout-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
            box-shadow: none;
            z-index: 2003;
        }

        .checkout-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .checkout-btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            20% {
                transform: scale(25, 25);
                opacity: 0.3;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }

        /* Carrito vacío */
        .cart-empty {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .cart-empty p {
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        /* Botón flotante del carrito - MEJORADO */
        .cart-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--color-white);
            color: var(--color-black);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid var(--color-white);
            visibility: visible !important;
        }

        .cart-button:hover {
            transform: scale(1.1) translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            background: var(--color-black);
            color: var(--color-white);
        }

        .cart-button svg {
            width: 30px;
            height: 30px;
            transition: transform 0.3s;
        }

        .cart-button svg path {
            fill: currentColor;
        }

        .cart-button:hover svg {
            transform: rotate(-10deg);
        }

        .cart-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--color-red);
            color: var(--color-white);
            width: 26px;
            height: 26px;
            border-radius: 50%;
            font-size: 0.85rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--color-red);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .cart-count:empty {
            display: none;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .cart-button.pulse {
            animation: pulse 0.3s ease-in-out;
        }

        /* Líneas de ticket */
        .ticket-line {
            border-bottom: 1px dashed #ccc;
            margin: 10px 0;
        }

        .ticket-divider {
            border-top: 2px dashed #333;
            margin: 40px 0;
        }

        /* Estilos para formulario del cliente */
        .customer-info {
            margin-top: 20px;
            padding: 20px;
            background: #f8f8f8;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-group {
            flex: 1;
            margin-bottom: 15px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            color: #333;
        }

        .form-group label[for*="Name"]::after,
        .form-group label[for*="DNI"]::after,
        .form-group label[for*="Email"]::after,
        .form-group label[for*="Phone"]::after,
        .form-group label[for*="Address"]::after {
            content: " *";
            color: var(--color-red);
            opacity: 0.7;
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.95rem;
            color: #333;
            background: #fff;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #666;
            box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* ====== NUEVOS ESTILOS PARA VALIDACIÓN ====== */
        .form-input.error,
        .form-textarea.error,
        .shipping-select.error {
            border-color: var(--color-red) !important;
            background-color: #fff8f8;
        }

        .error-message {
            color: var(--color-red);
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
            font-weight: normal;
        }

        .error-message.show {
            display: block;
        }

        .form-group.error label {
            color: var(--color-red);
        }

        .form-input.valid:not(:focus),
        .form-textarea.valid:not(:focus) {
            border-color: #4CAF50 !important;
        }

        /* ====== NUEVOS ESTILOS PARA CONFIRMACIÓN DE PEDIDO ====== */
        .order-confirmation {
            display: none;
            flex-direction: column;
        }

        .order-confirmation.active {
            display: flex;
        }

        .confirmation-header {
            padding: 30px 20px 20px;
            text-align: center;
        }

        .confirmation-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            color: white;
            animation: bounce 0.5s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .confirmation-title {
            font-size: 1.8rem;
            margin-bottom: 10px;
            font-weight: bold;
            text-align: center;
        }

        .confirmation-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 20px;
            text-align: center;
        }

        .confirmation-body {
            flex: 1;
            overflow-y: auto;
            background: #fff;
        }

        .confirmation-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px dashed #ddd;
        }

        .confirmation-section:last-child {
            border-bottom: none;
        }

        .section-header {
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: #333;
            text-transform: uppercase;
        }

        .order-number {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-bottom: 40px;
            border: 2px dashed #4CAF50;
        }

        .order-number-code {
            font-size: 1.4rem;
            font-weight: bold;
            color: #333;
            letter-spacing: 2px;
            margin: 10px 0;
        }

        .order-number-label {
            font-size: 0.9rem;
            color: #666;
        }

        .order-details-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            margin-bottom: 12px;
        }

        .detail-label {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 4px;
            display: block;
        }

        .detail-value {
            font-size: 0.95rem;
            color: #333;
            font-weight: 500;
            word-break: break-word;
        }

        .order-summary {
            background: #f8f8f8;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .summary-item.total {
            font-weight: bold;
            font-size: 1.1rem;
            padding-top: 10px;
            margin-top: 10px;
            border-top: 2px solid #ddd;
        }

        .next-steps {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #4CAF50;
        }

        .steps-title {
            font-weight: bold;
            color: #2e7d32;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .steps-list {
            list-style: none;
            padding: 0;
        }

        .steps-list li {
            margin-bottom: 12px;
            padding-left: 24px;
            position: relative;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .steps-list li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #4CAF50;
            font-weight: bold;
        }

        .btn-continue {
            background: var(--color-black);
            color: var(--color-white);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            text-decoration: none;
        }

        .btn-continue:hover {
            background: #333;
            transform: translateY(-2px);
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-whatsapp:hover {
            background: #1da851;
            transform: translateY(-2px);
        }

        .btn-whatsapp svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }

        /* Ocultar el formulario cuando se muestra la confirmación */
        .cart-items-container.hidden,
        .ticket-summary.hidden,
        .cart-items.hidden {
            display: none !important;
        }

        /* Animación para mostrar la confirmación */
        .order-confirmation {
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* ====== FIN NUEVOS ESTILOS ====== */

        @media (max-width: 1200px) {
            .home-section--header h1 {
                font-size: 3rem;
            }
            
            .card-somos,
            .card-contacto {
                flex-direction: column;
            }
            
            .card-somos--right,
            .card-contacto--right {
                height: 300px;
            }
        }

        @media (max-width: 992px) {
            .main-header--container {
                padding: 0 20px;
            }
            
            .header-left nav {
                display: none;
            }
            
            .home-section {
                flex-direction: column;
                padding: 30px 0;
            }
            
            .home-section--left {
                padding-right: 0;
                margin-bottom: 40px;
            }
            
            .home-section--right {
                width: 100%;
                flex-direction: row;
                justify-content: center;
                gap: 40px;
            }
            
            .main-footer--bottom {
                flex-direction: column;
                gap: 30px;
                text-align: center;
            }
            
            .main-footer--bottom form {
                flex-direction: column;
                width: 100%;
            }
            
            .main-footer--bottom input[type="email"] {
                min-width: auto;
                width: 100%;
            }
        }

        @media (max-width: 768px) {
            .home-section--header h1 {
                font-size: 2.5rem;
            }
            
            .btn-container {
                align-items: flex-start;
            }
            
            .review-card {
                padding: 20px;
            }
            
            #main-sidebar {
                display: none;
            }
            
            #main-wrapper {
                margin-left: 0;
            }
            
            #main-header {
                padding-left: 0;
            }
            
            .home-hero {
                margin-left: 0;
                width: 100%;
            }
            
            #main-footer {
                margin-left: 0;
                z-index: 999;
            }
            
            .cart-sidebar {
                width: 100%;
                right: -100%;
            }
            
            .cart-button {
                bottom: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            .cart-button svg {
                width: 25px;
                height: 25px;
            }
            
            /* Grid responsive para productos */
            .products-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
            }

            .btn-add-cart {
                padding: 10px 20px;
                font-size: 0.8rem;
            }

            /* Responsive para formulario */
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .checkout-btn {
                padding: 16px;
                font-size: 1.1rem;
            }

            .customer-info {
                padding: 15px;
            }

            /* Modal responsive */
            .product-modal {
                max-height: 95vh;
            }
            
            .product-modal-content {
                flex-direction: column;
            }
            
            .product-modal-image {
                padding: 20px;
            }
            
            .product-modal-image img {
                max-height: 250px;
            }
            
            .product-modal-info {
                padding: 25px;
            }
            
            .product-modal-title {
                font-size: 1.8rem;
            }
        }

        /* Estilos para desktop - 4 columnas */
        @media (min-width: 1200px) {
            .products-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 30px;
            }
        }
        
        /* Estilos para tablets - 3 columnas */
        @media (min-width: 768px) and (max-width: 1199px) {
            .products-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 25px;
            }
        }

        .btn-white-border {
            border: 1px solid var(--color-white);
            color: var(--color-white);
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
        }

        /* AÑADIR ESTO: Estilo para el contador en los botones de filtro */
        .btn-white-border sup {
            margin-left: 5px;
            font-size: 0.9em;
            font-weight: bold;
            color: var(--color-accent);
        }

        .btn-white-border.active sup {
            color: var(--color-black);
        }

        .btn-white-border:hover,
        .btn-white-border.active {
            background-color: var(--color-white);
            color: var(--color-black);
        }

        /* Estilos para detalles de envío */
        .delivery-row {
            margin-bottom: 8px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .delivery-row:last-child {
            margin-bottom: 0;
        }

        .delivery-row strong {
            display: inline-block;
            min-width: 120px;
            color: #333;
        }

        .delivery-row span {
            color: #666;
        }

        /* Añade al final del CSS */
        .confirmation-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
        }

        .btn-whatsapp {
            background: #25D366;
            color: white;
            padding: 18px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 1.1rem;
            border: none;
            cursor: pointer;
        }

        .btn-whatsapp:hover {
            background: #1da851;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3);
        }

        .btn-whatsapp svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .btn-continue {
            background: var(--color-black);
            color: var(--color-white);
            padding: 18px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s;
            text-decoration: none;
            border: none;
            cursor: pointer;
            font-size: 1.1rem;
        }

        .btn-continue:hover {
            background: #333;
            transform: translateY(-2px);
        }

        /* ====== ESTILOS PARA LISTA DE PRODUCTOS EN CONFIRMACIÓN ====== */
        .confirmation-products-list {
            margin: 20px 0;
        }

        .confirmation-product-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f8f8;
            border-radius: 8px;
        }

        .confirmation-product-item:last-child {
            margin-bottom: 0;
        }

        .product-item-info {
            flex: 1;
        }

        .product-item-name {
            margin-bottom: 5px;
            color: #333;
            font-size: 0.95rem;
        }

        .product-item-details {
            display: flex;
            gap: 15px;
            font-size: 0.85rem;
            color: #666;
        }

        .product-item-details span {
            display: inline-flex;
            align-items: center;
        }

        .product-item-price {
            color: #333;
            text-align: right;
            min-width: 80px;
        }

        .product-item-unit {
            font-size: 0.8rem;
            color: #888;
            margin-left: 3px;
        }

        .product-item-total {
            font-weight: bold;
            color: var(--color-black);
            min-width: 100px;
            text-align: right;
            font-size: 1rem;
        }

        /* Para pantallas pequeñas */
        @media (max-width: 768px) {
            .confirmation-product-item {
                align-items: flex-start;
                gap: 10px;
            }
            
            .product-item-price,
            .product-item-total {
                align-self: flex-end;
            }
        }

        .h2, h2 {
            margin-bottom: 20px;
        }

        /* PORTAL DE BIENVENIDA - EXACTO COMO STRANGE */
        .welcome-portal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 99999;
            font-family: 'Helvetica Neue', Arial, sans-serif;
        }

        .welcome-portal.active {
            display: flex;
        }

        .portal-background-blur {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            background: rgba(0, 0, 0, 0.7);
            z-index: 1;
        }

        .portal-container {
            color: #fff;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            padding: 50px 40px;
            text-align: center;
            position: relative;
            z-index: 2;
        }

        .portal-logo {
            margin-bottom: 30px;
        }

        .portal-logo img {
            width: 120px;
            height: auto;
        }

        .portal-content h1 {
            font-size: 2.5rem;
            font-weight: 400;
            line-height: 1.2;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .portal-strong {
            font-weight: 700;
            display: block;
            font-size: 3.2rem;
            margin-top: 10px;
            letter-spacing: 1px;
        }

        .portal-content p {
            font-size: 1.2rem;
            line-height: 1.6;
            margin-bottom: 40px;
            opacity: 0.9;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .portal-actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 30px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .portal-btn {
            padding: 18px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 30px;
            border: 2px solid;
            width: 100%;
        }

        .portal-btn-primary {
            background: #fff;
            color: #000;
            border-color: #fff;
        }

        .portal-btn-primary:hover {
            background: #000;
            color: #fff;
            transform: translateY(-2px);
        }

        .portal-btn-secondary {
            background: transparent;
            color: #fff;
            border-color: #fff;
        }

        .portal-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .checkout-btn {
                margin-bottom: 80px; /* Espacio para el botón */
            }

            .portal-container {
                padding: 40px 25px;
                width: 95%;
            }
            
            .portal-content h1 {
                font-size: 2rem;
            }
            
            .portal-strong {
                font-size: 2.5rem;
            }
            
            .portal-content p {
                font-size: 1.1rem;
            }
            
            .portal-btn {
                padding: 16px 25px;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .portal-container {
                padding: 30px 20px;
            }
            
            .portal-content h1 {
                font-size: 1.8rem;
            }
            
            .portal-strong {
                font-size: 2.2rem;
            }
            
            .portal-content p {
                font-size: 1rem;
            }
            
            .portal-actions {
                gap: 12px;
            }
        }

        /* AÑADIR ESTO PARA PREVENIR SCROLL MIENTRAS EL PORTAL ESTÉ ACTIVO */
        body.portal-active {
            overflow: hidden;
        }

        .snow-canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            pointer-events: none;
            overflow: hidden;
        }

        #snowCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
        }
    </style>
    
    <!-- Schema Markup -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Brewery",
        "name": "El Oso",
        "description": "Cerveza artesanal en Quilmes, Buenos Aires",
        "url": "https://eloso.ar/",
        "address": {
            "@type": "PostalAddress",
            "streetAddress": "Rodolfo López 1561",
            "addressLocality": "Quilmes",
            "addressRegion": "Buenos Aires",
            "postalCode": "1878",
            "addressCountry": "AR"
        },
        "geo": {
            "@type": "GeoCoordinates",
            "latitude": "-34.7200",
            "longitude": "-58.2580"
        },
        "image": "https://eloso.ar/images/logo/logo-blanco.png?v=15",
        "priceRange": "$$",
        "servesCuisine": "Cerveza Artesanal",
        "openingHours": "Mo-Su 09:00-21:00",
        "telephone": "+5491123495971",
        "sameAs": [
            "https://instagram.com/elosocerveza"
        ]
    }
    </script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-K21FSGK2ZY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-K21FSGK2ZY', {
            'debug_mode': false,
            'transport_type': 'beacon',
            'page_title': document.title,
            'page_location': window.location.href,
            'allow_google_signals': true,
            'allow_ad_personalization_signals': true,
            'cookie_flags': 'SameSite=None;Secure'
        });
    </script>

    <!-- Clarity -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "uruxvp2ghy");
    </script>

    <!-- Google Search Console Verification -->
    <meta name="google-site-verification" content="xL0bF1MF2lTpuOwKsNkd2PNiPxs-o35IuaLXh0v3slE">
</head>
<body>
    <div id="welcomePortal" class="welcome-portal active">
        <div class="portal-background-blur"></div>
        <div id="snowCanvasContainer" class="snow-canvas-container">
            <canvas id="snowCanvas"></canvas>
        </div>
        <div class="portal-container">
            <div class="portal-logo">
                <img src="images/logo/logo-120x120.png" alt="El Oso Logo">
            </div>
            <div class="portal-content">
                <h1><strong class="portal-strong">ALTO AHÍ, FORASTERO...</strong></h1>
                <p>Llegaste al refugio de El Oso. Detrás de este umbral solo hay lúpulo indomable, maltas oscuras y cervezas que muerden. Si tienes la garganta seca y ya soplaste más de 18 velitas, adelante.</p>
            </div>
            <div class="portal-actions">
                <button class="portal-btn portal-btn-primary" id="portalConfirmBtn">ENTRAR AL REFUGIO <br><small>(Soy mayor de 18 años)</small></button>
                <button class="portal-btn portal-btn-secondary" id="portalDenyBtn">VOLVER A LA MANADA</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header id="main-header" class="header-fixed header-black">
        <div class="main-header--container">
            <div class="header-left"></div>
            <div class="header-right">
                <a class="logo" href="#" aria-label="El Oso - Inicio"></a>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside id="main-sidebar" class="main-sidebar sidebar-active">
        <div class="main-sidebar--logo" aria-label="El Oso - Inicio">
            <a href="#">
                <img src="images/logo/logo-64x64.png" alt="mapaches">
            </a>
        </div>
        <nav class="main-sidebar--nav">
            <a href="#tienda" aria-label="Ir a la sección de tienda">Tienda</a>
            <a href="#resenas" aria-label="Ir a la sección de reseñas">Reseñas</a>
            <a href="#somos" aria-label="Ir a la sección ¿Qué somos?">¿Qué somos?</a>
            <a href="#contacto" aria-label="Ir a la sección de contacto">Contacto</a>
        </nav>
    </aside>

    <!-- Contenido principal -->
    <main id="main-wrapper">
        <!-- Hero Section -->
        <section class="home-hero" id="hero">
            <form class="home-hero--content visible">
                <div class="home-hero--text">
                    <h1>"Es curioso cómo a veces uno simplemente encuentra cosas" <span>- Ted Mosby</span></h1>
                </div>
            </form>
            <img class="bg" src="images/banners/hero.jpg" alt="strange mapaches">
        </section>

        <!-- Shop Section - ACTUALIZADA CON GRID DE PRODUCTOS -->
        <section class="home-section home-shop" id="tienda">
            <div class="container">
                <div class="home-section--left">
                    <div class="home-section--header">
                        <h1>Tienda</h1>
                        <div class="btn-container">
                            <button class="btn-white-border active" data-filter="cerveza">
                                <span>CERVEZAS</span><sup id="count-cerveza">0</sup>
                            </button>
                            <button class="btn-white-border" data-filter="combo">
                                <span>PACKS</span><sup id="count-combo">0</sup>
                            </button>
                            <button class="btn-white-border" data-filter="mixto">
                                <span>MIXTOS</span><sup id="count-mixto">0</sup>
                            </button>
                        </div>
                    </div>
                    <div class="home-shop--content">
                        <!-- Grid de productos se cargará aquí dinámicamente -->
                        <div class="products-grid" id="productsGrid">
                            <!-- Los productos se cargarán dinámicamente desde Google Sheets -->
                            <div class="loading-products" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                                <div style="display: inline-block; width: 40px; height: 40px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite;"></div>
                                <p style="margin-top: 15px; color: #aaa;">Cargando productos...</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="home-section--right side-nav">
                    <!-- Botones de navegación lateral (mantenidos para consistencia) -->
                    <button class="swiper-next" aria-label="Siguiente diapositiva en tienda">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51.79 63.28">
                            <path d="M51.29 26.09v11.23L.51 62.48V49.37L37.25 31.7.62 13.92.51.81z"></path>
                        </svg>
                    </button>
                    <button class="swiper-prev disabled" aria-label="Diapositiva anterior en tienda">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51.79 63.28">
                            <path d="M51.29 26.09v11.23L.51 62.48V49.37L37.25 31.7.62 13.92.51.81z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- Reseñas Section -->
        <section class="home-section home-resenas" id="resenas">
            <div class="container">
                <div class="home-section--left">
                    <div class="home-section--header">
                        <h1>Reseñas</h1>
                        <div class="btn-container">
                            <a href="https://maps.app.goo.gl/Q2Y9KRUgTvGK2Uy28" target="_blank" class="reviews-button">
                                <span>Ver más en Google Maps</span>
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M4 8a.5.5 0 0 1 .5-.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5A.5.5 0 0 1 4 8z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                    <div class="home-resenas--content">
                        <div class="swiper mySwiperReviews">
                            <div class="swiper-wrapper">
                                <!-- Reseña 1 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">Hernan Fernandez</div>
                                                <div class="reviewer-details">Local Guide · 199 opiniones</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace un mes</div>
                                        </div>
                                        <div class="review-content">
                                            Los conoci en la feria Cleta,compre la cerveza TSIA,la salsa picante y las berenjenas...los productos,IMPECABLES! proximamente arranca la degustacion de otras birras y la atencion de los 2 chicos q estaban en Cleta (presumo los dueños del emprendimiento)tambien de 10!
                                        </div>
                                    </article>
                                </div>
                                <!-- Reseña 2 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">Fernando Ariel PEREZ PARDO</div>
                                                <div class="reviewer-details">2 opiniones · 2 fotos</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace 3 meses</div>
                                        </div>
                                        <div class="review-content">
                                            Muy rica birra, ideal para juntada con amigos, y también para darse un gustito solo😉!
                                            Un 10 todas sus variedades🍺 saluttt…
                                        </div>
                                    </article>
                                </div>
                                <!-- Reseña 3 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">Agustina Delfino</div>
                                                <div class="reviewer-details">2 opiniones · 1 foto</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace 3 meses</div>
                                        </div>
                                        <div class="review-content">
                                            Me encantan las cervezas que hacen. He probado 5 estilos diferentes y la verdad que no puedo decidir cuál me gusta más. Excelentes todas. Y ninguna me cayó pesada ni me dió dolor de cabeza. 👏 Seguiré comprando 🍻…
                                        </div>
                                    </article>
                                </div>
                                <!-- Reseña 4 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">Nicolas Garcia</div>
                                                <div class="reviewer-details">6 opiniones · 6 fotos</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace 3 meses</div>
                                        </div>
                                        <div class="review-content">
                                            Las mejores birras artesanales que he probado. Las veces que probé otras marcas eran fuertes, con demasiado gusto a alcohol. Las de El Oso son suaves y con el sabor de los ingredientes marcados. No cambio más. 👌…
                                        </div>
                                    </article>
                                </div>
                                <!-- Reseña 5 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">Sheyla Garcia</div>
                                                <div class="reviewer-details">1 opinión</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace 3 meses</div>
                                        </div>
                                        <div class="review-content">
                                            Las cervezas artesanales El Oso están riquísimas 🍺. Naturales, sin conservantes y con un sabor que se nota hecho con amor💛 ¡Súper recomendadas!…
                                        </div>
                                    </article>
                                </div>
                                <!-- Reseña 6 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">Lautaro Nievas</div>
                                                <div class="reviewer-details">5 opiniones · 3 fotos</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace 3 meses</div>
                                        </div>
                                        <div class="review-content">
                                            Muy buenas birras! Mi preferida es la VIKA. EXCELENTE atención de los dueños.
                                        </div>
                                    </article>
                                </div>
                                <!-- Reseña 7 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">osmar ramirez</div>
                                                <div class="reviewer-details">Local Guide · 38 opiniones · 10 fotos</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace 3 meses</div>
                                        </div>
                                        <div class="review-content">
                                            Excelente cerveza artesanal, una vez que la probaste no consumis más una cerveza industrial 👍👏…
                                        </div>
                                    </article>
                                </div>
                                <!-- Reseña 8 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">Gris Alvez</div>
                                                <div class="reviewer-details">13 opiniones</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace 3 meses</div>
                                        </div>
                                        <div class="review-content">
                                            Muy rica cerveza ✨🙌…
                                        </div>
                                    </article>
                                </div>
                                <!-- Reseña 9 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">Andrea Saavedra</div>
                                                <div class="reviewer-details">1 opinión</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace un mes</div>
                                        </div>
                                        <div class="review-content">
                                            Exquisita...!! Alucinante...!!
                                            Delicias al paladar🤤🤤🤤…
                                        </div>
                                    </article>
                                </div>
                                <!-- Reseña 10 -->
                                <div class="swiper-slide">
                                    <article class="review-card">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <div class="reviewer-name">maría alejandra hambalek</div>
                                                <div class="reviewer-details">4 opiniones · 15 fotos</div>
                                                <div class="review-stars">
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                    <span class="star">★</span>
                                                </div>
                                            </div>
                                            <div class="review-date">Hace 3 meses</div>
                                        </div>
                                        <div class="review-content">
                                            Excelentes productos y hechos a conciencia!
                                        </div>
                                    </article>
                                </div>
                            </div>
                            <div class="swiper-button-next"></div>
                            <div class="swiper-button-prev"></div>
                        </div>
                    </div>
                </div>
                <div class="home-section--right side-nav">
                    <button class="swiper-next" aria-label="Siguiente reseña">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51.79 63.28">
                            <path d="M51.29 26.09v11.23L.51 62.48V49.37L37.25 31.7.62 13.92.51.81z"></path>
                        </svg>
                    </button>
                    <button class="swiper-prev disabled" aria-label="Reseña anterior">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51.79 63.28">
                            <path d="M51.29 26.09v11.23L.51 62.48V49.37L37.25 31.7.62 13.92.51.81z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- ¿Qué somos? Section -->
        <section class="home-section home-somos" id="somos">
            <div class="container">
                <div class="home-section--left">
                    <div class="home-section--header">
                        <h1>¿Quiénes Somos?</h1>
                    </div>
                    <div class="home-somos--content">
                        <div class="swiper mySwiper3">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide">
                                    <article class="card-somos">
                                        <div class="card-somos--left">
                                            <div class="card-somos--content">
                                                <div>
                                                    <p>¡Hola! Somos Cristian y Ezequiel, dos hermanos nacidos en Quilmes que arrancaron a hacer cerveza por pasión… y se nos fue de las manos (por suerte).</p>
                                                    <p>Así nació El Oso: un proyecto cervecero donde mandan el sabor, la curiosidad y las ganas de hacer birra bien hecha. Elaboramos micro-lotes, con recetas propias, ingredientes naturales y métodos tradicionales. Nuestras cervezas son sin filtrar, sin conservantes y gasificadas de forma natural.</p>
                                                    <p>No hacemos cerveza para que pase desapercibida. Hacemos cerveza para compartir, para la juntada, para el asado, para ese "¿abrimos otra?". Cada estilo tiene su personalidad, pero todas tienen algo en común: están hechas con dedicación y muchas ganas de que del otro lado alguien la disfrute.</p>
                                                    <p>Si te gusta descubrir sabores, brindar seguido y apoyar lo hecho a pequeña escala, ya sos parte del mundo El Oso.</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card-somos--right">
                                            <figure>
                                                <img src="images/banners/nosotros.jpg?v=15" alt="Fábrica Strange Brewing">
                                            </figure>
                                        </div>
                                    </article>
                                </div>
                            </div>
                            <div class="swiper-button-next"></div>
                            <div class="swiper-button-prev"></div>
                        </div>
                    </div>
                </div>
                <div class="home-section--right side-nav">
                    <button class="swiper-next" aria-label="Siguiente información">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51.79 63.28">
                            <path d="M51.29 26.09v11.23L.51 62.48V49.37L37.25 31.7.62 13.92.51.81z"></path>
                        </svg>
                    </button>
                    <button class="swiper-prev disabled" aria-label="Información anterior">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51.79 63.28">
                            <path d="M51.29 26.09v11.23L.51 62.48V49.37L37.25 31.7.62 13.92.51.81z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- Contacto Section -->
        <section class="home-section home-contacto" id="contacto">
            <div class="container">
                <div class="home-section--left">
                    <div class="home-section--header">
                        <h1>Contacto</h1>
                        <div class="btn-container">
                            <a href="https://wa.me/5491123495971" target="_blank" class="btn-white-border" aria-label="Hablar por WhatsApp"><span>Whatsapp</span></a>
                            <a href="https://instagram.com/elosocerveza" target="_blank" class="btn-white-border" aria-label="Síguenos en Instagram"><span>Instagram</span></a>
                            <a href="https://www.facebook.com/profile.php?id=61574456096960" target="_blank" class="btn-white-border" aria-label="Síguenos en Facebook"><span>Facebook</span></a>
                        </div>
                    </div>
                    <div class="home-contacto--content">
                        <div class="swiper mySwiper4">
                            <div class="swiper-wrapper">
                                <div class="swiper-slide">
                                    <article class="card-contacto">
                                        <div class="card-contacto--left">
                                            <div style="margin-bottom: 2rem;">
                                                <h2><b>El Oso</b></h2>
                                                <div class="contacto-row">
                                                    <div class="contacto-row--left">LUNES A DOMINGOS</div>
                                                    <div class="contacto-row--right">12 - 00HS</div>
                                                </div>
                                                <div class="contacto-row">
                                                    <div class="contacto-row--left">ENVÍOS (Consultas)</div>
                                                    <div class="contacto-row--right">11 2349 5971</div>
                                                </div>
                                                <div class="contacto-row">
                                                    <div class="contacto-row--left">RETIROS</div>
                                                    <div class="contacto-row--right">QUILMES - F. VARELA</div>
                                                </div>
                                            </div>
                                        </div>
                                    </article>
                                </div>
                            </div>
                            <div class="swiper-button-next"></div>
                            <div class="swiper-button-prev"></div>
                        </div>
                    </div>
                </div>
                <div class="home-section--right side-nav">
                    <button class="swiper-next" aria-label="Siguiente información de contacto">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51.79 63.28">
                            <path d="M51.29 26.09v11.23L.51 62.48V49.37L37.25 31.7.62 13.92.51.81z"></path>
                        </svg>
                    </button>
                    <button class="swiper-prev disabled" aria-label="Información de contacto anterior">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51.79 63.28">
                            <path d="M51.29 26.09v11.23L.51 62.48V49.37L37.25 31.7.62 13.92.51.81z"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer id="main-footer">
        <div class="container">
            <div class="main-footer--top">
                <div class="columna"><a href="#tienda" aria-label="Ir a la sección de tienda">Tienda</a></div>
                <div class="columna"><a href="#resenas" aria-label="Ir a la sección de reseñas">Reseñas</a></div>
                <div class="columna"><a href="#somos" aria-label="Ir a la sección ¿Qué somos?">¿Qué Somos?</a></div>
                <div class="columna"><a href="#contacto" aria-label="Ir a la sección de contacto">Contacto</a></div>
            </div>
            <div class="main-footer--bottom">
                <div class="right">
                    <p>© 2026 El Oso. Todos los derechos reservados.</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- ====== MODAL PARA DETALLES DEL PRODUCTO ====== -->
    <div class="product-modal-overlay" id="productModalOverlay">
        <div class="product-modal" id="productModal">
            <button class="product-modal-close" id="productModalClose">&times;</button>
            <div class="product-modal-content" id="productModalContent">
                <!-- El contenido se llenará dinámicamente -->
            </div>
        </div>
    </div>

    <!-- Overlay del carrito -->
    <div class="cart-overlay" id="cartOverlay"></div>

    <!-- Botón flotante del carrito - MEJORADO -->
    <div class="cart-button" id="cartToggle">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
            <path d="M0 72C0 58.7 10.7 48 24 48L69.3 48C96.4 48 119.6 67.4 124.4 94L124.8 96L537.5 96C557.5 96 572.6 114.2 568.9 133.9L537.8 299.8C532.1 330.1 505.7 352 474.9 352L171.3 352L176.4 380.3C178.5 391.7 188.4 400 200 400L456 400C469.3 400 480 410.7 480 424C480 437.3 469.3 448 456 448L200.1 448C165.3 448 135.5 423.1 129.3 388.9L77.2 102.6C76.5 98.8 73.2 96 69.3 96L24 96C10.7 96 0 85.3 0 72zM160 528C160 501.5 181.5 480 208 480C234.5 480 256 501.5 256 528C256 554.5 234.5 576 208 576C181.5 576 160 554.5 160 528zM384 528C384 501.5 405.5 480 432 480C458.5 480 480 501.5 480 528C480 554.5 458.5 576 432 576C405.5 576 384 554.5 384 528zM336 142.4C322.7 142.4 312 153.1 312 166.4L312 200L278.4 200C265.1 200 254.4 210.7 254.4 224C254.4 237.3 265.1 248 278.4 248L312 248L312 281.6C312 294.9 322.7 305.6 336 305.6C349.3 305.6 360 294.9 360 281.6L360 248L393.6 248C406.9 248 417.6 237.3 417.6 224C417.6 210.7 406.9 200 393.6 200L360 200L360 166.4C360 153.1 349.3 142.4 336 142.4z"/>
        </svg>
        <span class="cart-count" id="cartCount">0</span>
    </div>

    <!-- Sidebar del carrito - Estilo Ticket de Bar ACTUALIZADO -->
    <div class="cart-sidebar" id="cartSidebar">
        <div class="cart-ticket">
            <div class="ticket-header">
                <h2 id="closeCart">< Continuar comprando</h2>
            </div>
            
            <div class="ticket-body">
                <!-- Contenedor del carrito normal -->
                <div class="cart-items-container" id="cartItemsContainer">
                    <div class="ticket-section">
                        <div class="section-title">Carrito de compras</div>
                        <div class="cart-items" id="cartItems">
                            <!-- Los productos se agregarán aquí dinámicamente -->
                            <div class="cart-empty">
                                <p>Tu carrito está vacío</p>
                                <p>¡Agrega algunos productos para comenzar!</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Resumen combinado (siempre visible cuando hay productos) -->
                    <div class="ticket-summary" id="ticketSummary" style="display: none;">
                        <div class="ticket-section">
                            <div class="summary-row">
                                <span>Subtotal:</span>
                                <span id="cartSubtotal">$ 0</span>
                            </div>
                        </div>

                        <div class="free-shipping-notice" id="freeShippingNotice"></div>

                        <div class="ticket-section">
                            <div class="summary-row shipping">
                                <span>Envío a: <strong><span id="deliveryCity"></span></strong></span>
                                <span id="cartShipping">$ 0</span>
                            </div>
                            <div class="summary-row shipping">
                                <span>El día: <strong><span id="deliveryDay"></span></strong></span>
                            </div>
                            <div class="summary-row shipping">
                                <span>En el rango horario: <strong><span id="deliveryTime"></span></strong></span>
                            </div>
                            <div class="summary-row shipping">
                                <div class="form-group">
                                    <select id="deliveryLocation" class="shipping-select" required>
                                        <option value="" disabled selected>Seleccioná tu localidad</option>
                                        <option value="quilmes">Quilmes</option>
                                        <option value="bernal">Bernal</option>
                                        <option value="don-bosco">Don Bosco</option>
                                        <option value="ezpeleta">Ezpeleta</option>
                                        <option value="berazategui">Berazategui</option>
                                    </select>
                                    <div id="deliveryLocationError" class="error-message"></div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="summary-row total">
                            <span>TOTAL:</span>
                            <span id="cartTotal">$ 0</span>
                        </div>

                        <div class="ticket-divider"></div>

                        <div class="ticket-section">
                            <div class="section-title">INFORMACIÓN DEL CLIENTE</div>
                            
                            <div class="form-group">
                                <label for="customerName">Nombre completo</label>
                                <input type="text" id="customerName" class="form-input" placeholder="Ej: Juan Pérez" required>
                                <div id="customerNameError" class="error-message"></div>
                            </div>

                            <div class="form-group">
                                <label for="customerDNI">DNI</label>
                                <input type="text" id="customerDNI" class="form-input" placeholder="Ej: 12345678" required>
                                <div id="customerDNIError" class="error-message"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="customerEmail">Email</label>
                                <input type="email" id="customerEmail" class="form-input" placeholder="ejemplo@email.com" required>
                                <div id="customerEmailError" class="error-message"></div>
                            </div>

                            <div class="form-group">
                                <label for="customerPhone">Teléfono de contacto</label>
                                <input type="tel" id="customerPhone" class="form-input" placeholder="Ej: 11 2345-6789" required>
                                <div id="customerPhoneError" class="error-message"></div>
                            </div>
                            
                            <div class="form-group">
                                <label for="customerAddress">Dirección completa</label>
                                <input type="text" id="customerAddress" class="form-input" placeholder="Calle, número, piso, departamento" required>
                                <div id="customerAddressError" class="error-message"></div>
                            </div>
                            
                            <input type="hidden" id="customerCity">

                            <div class="form-group">
                                <label for="orderNotes">Notas para el pedido (opcional)</label>
                                <textarea id="orderNotes" class="form-textarea" placeholder="Ej: timbre roto, entrecalles, etc." rows="3"></textarea>
                            </div>
                        </div>
                        
                        <div class="payment-method">Compra 100% segura: Pagás recién cuando recibís tu pedido (Efectivo o Transferencia).</div>
                        
                        <button class="checkout-btn" id="checkoutBtn" disabled>COMPRAR</button>
                    </div>
                </div>
                
                <!-- Sección de confirmación de pedido (oculta por defecto) -->
                <div class="order-confirmation" id="orderConfirmation">
                    <div class="confirmation-body">
                        <h2 class="confirmation-title">¡PEDIDO CONFIRMADO!</h2>
                        <p class="confirmation-subtitle">Nuestro osomóvil te acercará tu pedido</p>

                        <div class="order-number">
                            <div class="order-number-label">NÚMERO DE PEDIDO</div>
                            <div class="order-number-code" id="confirmationOrderNumber">ELO-123456</div>
                            <div class="order-number-label">Guardá este número para futuras consultas</div>
                        </div>

                        <div class="confirmation-section">
                            <div class="section-header">
                                <div class="section-title">Tus datos</div>
                            </div>
                            <div class="order-summary">
                                <div class="summary-item">
                                    <span>Nombre</span>
                                    <span id="confirmationName"></span>
                                </div>
                                <div class="summary-item">
                                    <span>Teléfono</span>
                                    <span id="confirmationPhone"></span>
                                </div>
                                <div class="summary-item">
                                    <span>Email</span>
                                    <span id="confirmationEmail"></span>
                                </div>
                                <div class="summary-item">
                                    <span>DNI</span>
                                    <span id="confirmationDNI"></span>
                                </div>
                                <div class="summary-item">
                                    <span>Dirección</span>
                                    <span id="confirmationAddress"></span>
                                </div>
                                <div class="summary-item">
                                    <span>Localidad</span>
                                    <span id="confirmationCity"></span>
                                </div>
                                <div class="summary-item">
                                    <span>Entrega</span>
                                    <span id="confirmationDelivery"></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="confirmation-section">
                            <div class="section-header">
                                <div class="section-title">Productos</div>
                            </div>
                            <div class="confirmation-products-list" id="confirmationProductsList">
                                <!-- Los productos se cargarán aquí dinámicamente -->
                            </div>
                        </div>
                        
                        <div class="confirmation-section">
                            <div class="section-header">
                                <div class="section-title">Resumen</div>
                            </div>
                            <div class="order-summary">
                                <div class="summary-item">
                                    <span>Subtotal:</span>
                                    <span id="confirmationSubtotal">$ 15.000</span>
                                </div>
                                <div class="summary-item">
                                    <span>Envío:</span>
                                    <span id="confirmationShipping">$ 5.000</span>
                                </div>
                                <div class="summary-item total">
                                    <span>TOTAL:</span>
                                    <span id="confirmationTotal">$ 20.000</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="confirmation-section">
                            <div class="next-steps">
                                <div class="steps-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                                        <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                                    </svg>
                                    <span>¿QUÉ SIGUE AHORA?</span>
                                </div>
                                <ul class="steps-list">
                                    <li>Recibirás un mensaje de WhatsApp en las próximas 24 horas para coordinar la entrega</li>
                                    <li>Verifica que tus datos de contacto sean correctos</li>
                                    <li>Prepara el pago en efectivo o transferencia para cuando recibas tu pedido</li>
                                    <li>Guarda tu número de pedido para cualquier consulta</li>
                                    <li>Si no recibes noticias en 48 horas, contáctanos por WhatsApp al 11 2349 5971</li>
                                </ul>
                            </div>
                        </div>
                        <div class="confirmation-section" style="display: none;">
                            <div class="confirmation-actions">
                                <a href="#" id="whatsappConfirmBtn" class="btn-whatsapp" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                                        <path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"/>
                                    </svg>
                                    CONFIRMAR PEDIDO POR WHATSAPP
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        // ====== SISTEMA DE PRODUCTOS (ACTUALIZADO CON GOOGLE SHEETS) ======
        class ProductSystem {
            constructor() {
                this.currentFilter = 'cerveza';
                this.productsGrid = document.getElementById('productsGrid');
                this.filterButtons = document.querySelectorAll('#tienda .btn-white-border[data-filter]');
                this.products = [];
                this.APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwAiNXwXMsQCipyaAQB-QGTzBrS3PDRWF63m_SkcmCykfWnZjbcuLQm0VScFzy1VZ0FFg/exec';
                this.init();
                this.setupGlobalEventListeners();
            }

            async init() {
                await this.loadProductsFromGoogleSheet(); // Cargar desde Google Sheets
                this.renderProducts();
                this.setupEventListeners();
                this.updateProductCounts();
                this.setupModal();
            }

            async loadProductsFromGoogleSheet() {
                try {
                    // Mostrar estado de carga
                    this.productsGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
                            <div style="display: inline-block; width: 40px; height: 40px; border: 3px solid rgba(255,255,255,.3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite;"></div>
                            <p style="margin-top: 15px; color: #aaa;">Cargando productos...</p>
                        </div>
                    `;

                    // Intentar cargar desde Google Sheets
                    const response = await fetch(this.APPS_SCRIPT_URL + '?action=getProducts', {
                        method: 'GET',
                        mode: 'cors',
                        cache: 'no-cache'
                    });

                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }

                    const data = await response.json();
                    
                    if (data.success && Array.isArray(data.products)) {
                        // Procesar productos desde Google Sheets
                        this.products = data.products.map(item => ({
                            id: parseInt(item.id) || 0,
                            name: item.name || '',
                            category: this.normalizeCategory(item.category || ''),
                            price: this.parsePrice(item.price || '0'),
                            image: item.image || this.getDefaultImage(this.normalizeCategory(item.category || '')),
                            info: item.info || '',
                            active: item.active,
                            description: item.description || 'Sin descripción disponible',
                            presentation: item.presentation || this.getDefaultPresentation(this.normalizeCategory(item.category || '')),
                            stock: parseInt(item.stock) || 0
                        }));
                        
                        // Guardar en cache local
                        this.saveToCache();
                    } else {
                        throw new Error('Formato de datos inválido desde Google Sheets');
                    }
                } catch (error) {
                    console.error('❌ Error cargando productos desde Google Sheets:', error);
                    this.loadFromCache();
                    
                    // Si no hay cache, usar productos locales
                    if (this.products.length === 0) {
                        this.loadLocalProducts();
                    }
                }
            }

            saveToCache() {
                try {
                    localStorage.setItem('elOsoProductsCache', JSON.stringify(this.products));
                    localStorage.setItem('elOsoProductsCacheTime', Date.now().toString());
                } catch (error) {
                    console.error('Error guardando en cache:', error);
                }
            }

            loadFromCache() {
                try {
                    const cacheTime = localStorage.getItem('elOsoProductsCacheTime');
                    const cacheDuration = 30 * 60 * 1000; // 30 minutos
                    
                    if (cacheTime && (Date.now() - parseInt(cacheTime)) < cacheDuration) {
                        const cachedProducts = localStorage.getItem('elOsoProductsCache');
                        if (cachedProducts) {
                            this.products = JSON.parse(cachedProducts);
                            return true;
                        }
                    }
                } catch (error) {
                    console.error('Error cargando desde cache:', error);
                }
                return false;
            }

            loadLocalProducts() {
                // Productos locales como respaldo
                this.products = [
                    { 
                        id: 6, 
                        name: "ARUN - Blonde", 
                        category: "cerveza", 
                        price: 5000, 
                        image: "images/products/beers/arun-330.png?v=8", 
                        info: "Blonde | Alc. 4.5%", 
                        active: false,
                        description: "Una Blonde Ale refrescante y balanceada, con notas sutiles de malta y un final limpio. Perfecta para cualquier ocasión.",
                        presentation: "Botella 330ml"
                    },
                    { 
                        id: 7, 
                        name: "BENNU - Honey Wheat", 
                        category: "cerveza", 
                        price: 5000, 
                        image: "images/products/beers/bennu-330.png?v=8", 
                        info: "Honey Wheat | Alc. 4.5%", 
                        active: false,
                        description: "Cerveza de trigo con miel, suave y delicadamente dulce. Aromas a miel y notas cítricas.",
                        presentation: "Botella 330ml"
                    },
                    { 
                        id: 8, 
                        name: "EMBER - Dubbel", 
                        category: "cerveza", 
                        price: 5000, 
                        image: "images/products/beers/ember-330.png?v=8", 
                        info: "Dubbel | Alc. 5.0%", 
                        active: true,
                        description: "Dubbel belga tradicional con notas de caramelo, frutas oscuras y especias. Cuerpo medio y carbonatación moderada.",
                        presentation: "Botella 330ml"
                    },
                    { 
                        id: 10, 
                        name: "VIKA - New England IPA", 
                        category: "cerveza", 
                        price: 5000, 
                        image: "images/products/beers/vika-330.png?v=8", 
                        info: "New England IPA | Alc. 5.0%", 
                        active: true,
                        description: "IPA estilo New England, turbia y jugosa. Cargada de lúpulos que aportan sabores cítricos y tropicales.",
                        presentation: "Botella 330ml"
                    },
                    { 
                        id: 14, 
                        name: "NDALA - Chocolate Stout", 
                        category: "cerveza", 
                        price: 5000, 
                        image: "images/products/beers/ndala-330.png?v=8", 
                        info: "Chocolate Stout | Alc. 6.0%", 
                        active: true,
                        description: "Stout robusta con chocolate, con sabores a café tostado, chocolate amargo y malta caramelo.",
                        presentation: "Botella 330ml"
                    },
                    { 
                        id: 15, 
                        name: "RIAD - Red APA", 
                        category: "cerveza", 
                        price: 5000, 
                        image: "images/products/beers/riad-330.png?v=8", 
                        info: "Red APA | Alc. 5.0%", 
                        active: true,
                        description: "American Pale Ale roja, balanceada entre el amargor del lúpulo y la dulzura de la malta caramelo.",
                        presentation: "Botella 330ml"
                    },
                    { 
                        id: 17, 
                        name: "WENDY - Hybrid Lager", 
                        category: "cerveza", 
                        price: 5000, 
                        image: "images/products/beers/wendy-330.png?v=8", 
                        info: "Hybrid Lager | Alc. 4.5%", 
                        active: true,
                        description: "Lager híbrida refrescante y crujiente. Perfecta para tomar bien fría.",
                        presentation: "Botella 330ml"
                    },
                    { 
                        id: 18, 
                        name: "CLARA - American Blonde", 
                        category: "cerveza", 
                        price: 5000, 
                        image: "images/products/beers/clara-330.png?v=8", 
                        info: "American Blonde | Alc. 4.5%", 
                        active: true,
                        description: "Blonde Ale americana, ligera y refrescante con notas cítricas.",
                        presentation: "Botella 330ml"
                    },
                    { 
                        id: 20, 
                        name: "GRETA - Passion Blonde", 
                        category: "cerveza", 
                        price: 5000, 
                        image: "images/products/beers/greta-330.png?v=10", 
                        info: "Passion Blonde | Alc. 4.5%", 
                        active: true,
                        description: "Blonde Ale infusionada con maracuyá. Frutal, refrescante y ligera.",
                        presentation: "Botella 330ml"
                    }
                ];
            }
            
            // Helper functions para procesar datos de Google Sheets
            normalizeCategory(category) {
                if (!category) return 'cerveza';
                
                const categoryMap = {
                    'cerveza': 'cerveza',
                    'Cerveza': 'cerveza',
                    'CERVEZA': 'cerveza',
                    'combo': 'combo',
                    'Combo': 'combo',
                    'COMBO': 'combo',
                    'mixto': 'mixto',
                    'Mixto': 'mixto',
                    'MIXTO': 'mixto',
                    'picante': 'picante',
                    'Picante': 'picante',
                    'PICANTE': 'picante',
                    'conserva': 'conserva',
                    'Conserva': 'conserva',
                    'CONSERVA': 'conserva'
                };
                
                return categoryMap[category.toString().toLowerCase()] || 'cerveza';
            }

            parsePrice(priceString) {
                if (!priceString) return 0;
                
                // Remover símbolos de moneda y espacios
                let price = priceString.toString().replace(/[^\d,.]/g, '');
                
                // Convertir a número
                if (price.includes(',')) {
                    // Formato europeo/latino: 1.000
                    price = price.replace(/\./g, '').replace(',', '.');
                }
                
                const numericPrice = parseFloat(price);
                return isNaN(numericPrice) ? 0 : Math.round(numericPrice);
            }

            parseActive(availableString) {
                if (!availableString) return true;
                const lower = availableString.toString().toLowerCase().trim();
                return lower === 'si' || lower === 'sí' || lower === 'yes' || lower === 'true' || lower === '1' || lower === 'verdadero';
            }

            getDefaultImage(category) {
                const defaultImages = {
                    'cerveza': 'images/products/beers/default-beer.png',
                    'combo': 'images/products/combos/default-combo.png',
                    'mixto': 'images/products/mixtos/default-mixto.png',
                    'picante': 'images/products/picantes/default-picante.png',
                    'conserva': 'images/products/conservas/default-conserva.png'
                };
                return defaultImages[category] || 'images/products/default.png';
            }

            getDefaultPresentation(category) {
                switch(category) {
                    case 'cerveza':
                        return 'Botella 330ml';
                    case 'picante':
                        return 'Botella 100ml';
                    case 'conserva':
                        return 'Frasco 330ml';
                    case 'combo':
                        return 'Combo especial';
                    case 'mixto':
                        return 'Pack mixto';
                    default:
                        return 'Unidad';
                }
            }
            
            setupModal() {
                this.modalOverlay = document.getElementById('productModalOverlay');
                this.modalContent = document.getElementById('productModalContent');
                this.modalClose = document.getElementById('productModalClose');
                
                this.modalClose.addEventListener('click', () => {
                    this.closeModal();
                });
                
                this.modalOverlay.addEventListener('click', (e) => {
                    if (e.target === this.modalOverlay) {
                        this.closeModal();
                    }
                });
                
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.modalOverlay.classList.contains('active')) {
                        this.closeModal();
                    }
                });
            }

            openModal(product) {
                const quantity = this.getProductQuantity(product.id) || 1;
                const presentation = product.presentation || this.getDefaultPresentation(product.category);
                
                this.modalContent.innerHTML = `
                    <div class="product-modal-image">
                        <img src="${product.image}" alt="${product.name}" loading="lazy">
                    </div>
                    <div class="product-modal-info">
                        <h2 class="product-modal-title">${product.name.split(' - ')[0]}</h2>
                        <div class="product-modal-subtitle">${product.info}</div>
                        
                        <div class="product-modal-price">
                            <b>$ ${product.price.toLocaleString('es-AR')}</b> ${presentation}
                        </div>
                        
                        <div class="product-modal-description">
                            ${product.description}
                        </div>
                        
                        <div class="product-modal-details">
                            <div class="product-modal-detail-row">
                                <div class="product-modal-detail-label">Categoría:</div>
                                <div class="product-modal-detail-value">${this.getCategoryName(product.category)}</div>
                            </div>
                            <div class="product-modal-detail-row">
                                <div class="product-modal-detail-label">Presentación:</div>
                                <div class="product-modal-detail-value">${presentation}</div>
                            </div>
                            <div class="product-modal-detail-row">
                                <div class="product-modal-detail-label">Disponibilidad:</div>
                                <div class="product-modal-detail-value">${product.active ? 'En stock' : 'No disponible'}</div>
                            </div>
                        </div>
                        
                        <div class="product-modal-quantity">
                            <div class="quantity-controls-list">
                                <button class="quantity-btn-list" data-action="decrease" data-id="${product.id}">-</button>
                                <span class="quantity-display-list" id="modalQuantity-${product.id}">${quantity}</span>
                                <button class="quantity-btn-list" data-action="increase" data-id="${product.id}">+</button>
                            </div>
                        </div>
                        
                        ${product.active ? 
                            `<button class="product-modal-btn modal-add-to-cart-btn" id="modalAddToCart-${product.id}" 
                                    data-id="${product.id}" data-name="${product.name}" 
                                    data-price="${product.price}" data-category="${product.category}"
                                    data-presentation="${presentation}">
                                Agregar al Carrito
                            </button>` : 
                            `<button class="product-modal-btn" disabled style="opacity: 0.5; cursor: not-allowed;">
                                NO DISPONIBLE
                            </button>`
                        }
                    </div>
                `;
                
                this.modalOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            closeModal() {
                this.modalOverlay.classList.remove('active');
                document.body.style.overflow = 'auto';
            }

            setupGlobalEventListeners() {
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('quantity-btn-list') && e.target.closest('.shop-article')) {
                        this.handleListQuantityButton(e.target);
                    }
                    
                    if (e.target.classList.contains('quantity-btn-list') && e.target.closest('.product-modal')) {
                        this.handleModalQuantityButton(e.target);
                    }
                    
                    if (e.target.classList.contains('modal-add-to-cart-btn')) {
                        this.handleModalAddToCart(e.target);
                    }
                });
            }

            handleListQuantityButton(button) {
                const action = button.dataset.action;
                const productId = button.dataset.id;
                const quantityDisplay = document.getElementById(`quantity-${productId}`);
                
                if (!quantityDisplay) return;
                
                let quantity = parseInt(quantityDisplay.textContent) || 1;
                
                if (action === 'decrease' && quantity > 1) {
                    quantity--;
                    quantityDisplay.textContent = quantity;
                } else if (action === 'increase') {
                    quantity++;
                    quantityDisplay.textContent = quantity;
                }
            }

            handleModalQuantityButton(button) {
                const action = button.dataset.action;
                const productId = button.dataset.id;
                const quantityDisplay = document.getElementById(`modalQuantity-${productId}`);
                const addButton = document.getElementById(`modalAddToCart-${productId}`);
                
                if (!quantityDisplay) return;
                
                let quantity = parseInt(quantityDisplay.textContent) || 1;
                const product = this.products.find(p => p.id == productId);
                
                if (action === 'decrease' && quantity > 1) {
                    quantity--;
                    quantityDisplay.textContent = quantity;
                    if (addButton && product) {
                        addButton.textContent = `Agregar al Carrito`;
                    }
                } else if (action === 'increase') {
                    quantity++;
                    quantityDisplay.textContent = quantity;
                    if (addButton && product) {
                        addButton.textContent = `Agregar al Carrito`;
                    }
                }
            }

            handleModalAddToCart(button) {
                if (button.disabled) return;
                
                const productId = button.dataset.id;
                const quantityElement = document.getElementById(`modalQuantity-${productId}`);
                const quantity = quantityElement ? parseInt(quantityElement.textContent) : 1;
                const product = this.products.find(p => p.id == productId);
                
                if (!product) return;
                
                if (window.cartSystem) {
                    const productToAdd = {
                        id: product.id,
                        name: product.name,
                        price: product.price,
                        category: product.category,
                        presentation: button.dataset.presentation || this.getDefaultPresentation(product.category),
                        quantity: quantity
                    };
                    
                    window.cartSystem.addToCartFromModal(productToAdd, button);
                    
                    // Track add_to_cart event desde modal
                    if (window.analyticsSystem) {
                        window.analyticsSystem.trackEvent('add_to_cart', {
                            product_id: product.id,
                            product_name: product.name,
                            product_category: product.category,
                            product_price: product.price,
                            currency: 'ARS',
                            quantity: quantity,
                            source: 'modal'
                        });
                    }
                    
                    setTimeout(() => {
                        this.closeModal();
                    }, 800);
                }
            }

            getProductQuantity(productId) {
                if (window.cartSystem && window.cartSystem.cart) {
                    const itemInCart = window.cartSystem.cart.find(item => item.id == productId);
                    return itemInCart ? itemInCart.quantity : 1;
                }
                return 1;
            }

            getCategoryName(category) {
                const categories = {
                    'cerveza': 'Cerveza Artesanal',
                    'picante': 'Salsa Picante',
                    'conserva': 'Conserva Artesanal',
                    'combo': 'Combo Especial',
                    'mixto': 'Pack Mixto'
                };
                return categories[category] || 'Producto';
            }

            renderProducts() {
                const filteredProducts = this.products.filter(p => p.active && p.category === this.currentFilter);

                this.productsGrid.innerHTML = '';

                if (filteredProducts.length === 0) {
                    this.productsGrid.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: #aaa;">
                            <p style="font-size: 1.2rem; margin-bottom: 10px;">No hay productos disponibles en esta categoría</p>
                            <p>Próximamente agregaremos más productos</p>
                        </div>
                    `;
                    return;
                }

                filteredProducts.forEach(product => {
                    const productElement = this.createProductElement(product);
                    this.productsGrid.appendChild(productElement);
                });
                
                this.setupProductImageEvents();
            }

            createProductElement(product) {
                const div = document.createElement('div');
                div.className = `shop-article ${!product.active ? 'product-inactive' : ''}`;
                div.dataset.productId = product.id;
                div.dataset.category = product.category;

                const currentQuantity = this.getProductQuantity(product.id);
                const presentation = product.presentation || this.getDefaultPresentation(product.category);

                div.innerHTML = `
                    <figure class="shop-article--image">
                        <img src="${product.image}" alt="${product.name}" loading="lazy" class="product-image" data-id="${product.id}">
                    </figure>
                    <div class="shop-article--data">
                        <div class="shop-article--head">
                            <h2 class="shop-article--title">${product.name.split(' - ')[0]}</h2>
                            <div class="shop-article--info">${product.info}</div>
                        </div>
                        <div class="shop-article--precio">
                            <b>$ ${product.price.toLocaleString('es-AR')}</b> ${presentation}
                        </div>
                        
                        <div class="shop-article--quantity">
                            <div class="quantity-controls-list">
                                <button class="quantity-btn-list" data-action="decrease" data-id="${product.id}">-</button>
                                <span class="quantity-display-list" id="quantity-${product.id}">${currentQuantity}</span>
                                <button class="quantity-btn-list" data-action="increase" data-id="${product.id}">+</button>
                            </div>
                        </div>
                        
                        ${product.active ? 
                            `<button class="btn-add-cart" data-id="${product.id}" data-name="${product.name}" 
                                    data-price="${product.price}" data-category="${product.category}" 
                                    data-presentation="${presentation}">
                                Agregar al Carrito
                            </button>` : 
                            `<button class="btn-add-cart" style="opacity: 0.5; cursor: not-allowed;" disabled>
                                NO DISPONIBLE
                            </button>`
                        }
                    </div>
                `;

                return div;
            }

            setupProductImageEvents() {
                const productImages = document.querySelectorAll('.product-image');
                productImages.forEach(img => {
                    img.addEventListener('click', (e) => {
                        const productId = e.target.dataset.id;
                        const product = this.products.find(p => p.id == productId);
                        if (product) {
                            this.openModal(product);
                        }
                    });
                });
            }

            updateProductCounts() {
                const counts = {
                    all: this.products.filter(p => p.active).length,
                    cerveza: this.products.filter(p => p.active && p.category === 'cerveza').length,
                    combo: this.products.filter(p => p.active && p.category === 'combo').length,
                    mixto: this.products.filter(p => p.active && p.category === 'mixto').length
                };

                Object.keys(counts).forEach(category => {
                    const countElement = document.getElementById(`count-${category}`);
                    if (countElement) {
                        countElement.textContent = counts[category];
                    }
                });
            }

            setupEventListeners() {
                this.filterButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        this.filterButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        this.currentFilter = button.getAttribute('data-filter');
                        this.renderProducts();
                    });
                });
            }
        }

        // ====== CARRITO - ESTILO TICKET DE BAR (ACTUALIZADO) ======
        class CartSystem {
            constructor() {
                this.cart = JSON.parse(localStorage.getItem('elOsoCart')) || [];
                this.shippingCost = 5000;
                this.freeShippingThreshold = 30000;
                this.deliveryDays = [4, 5]; // 4 = jueves, 5 = viernes
                this.deliveryTimeRange = '11 a 20 hrs';
                this.APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwAiNXwXMsQCipyaAQB-QGTzBrS3PDRWF63m_SkcmCykfWnZjbcuLQm0VScFzy1VZ0FFg/exec';
                
                this.init();
                this.setupCartEventListeners();
            }

            init() {
                this.updateCartCount();
                this.renderCart();
                this.validateForm();
                this.updateFreeShippingNotice();
            }

            setupCartEventListeners() {
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('quantity-increase') || 
                        e.target.closest('.quantity-increase')) {
                        const button = e.target.classList.contains('quantity-increase') ? 
                            e.target : e.target.closest('.quantity-increase');
                        const item = button.closest('.ticket-item');
                        if (item) {
                            const id = item.dataset.id;
                            this.updateQuantity(id, 1);
                        }
                    }
                    
                    if (e.target.classList.contains('quantity-decrease') || 
                        e.target.closest('.quantity-decrease')) {
                        const button = e.target.classList.contains('quantity-decrease') ? 
                            e.target : e.target.closest('.quantity-decrease');
                        const item = button.closest('.ticket-item');
                        if (item) {
                            const id = item.dataset.id;
                            this.updateQuantity(id, -1);
                        }
                    }
                    
                    if (e.target.classList.contains('remove-item') || 
                        e.target.closest('.remove-item')) {
                        const button = e.target.classList.contains('remove-item') ? 
                            e.target : e.target.closest('.remove-item');
                        const item = button.closest('.ticket-item');
                        if (item) {
                            const id = item.dataset.id;
                            this.removeFromCart(id);
                        }
                    }
                    
                    if (e.target.classList.contains('btn-add-cart') || 
                        e.target.closest('.btn-add-cart')) {
                        const button = e.target.classList.contains('btn-add-cart') ? 
                            e.target : e.target.closest('.btn-add-cart');
                        if (!button.disabled) {
                            const productId = button.dataset.id;
                            const quantityElement = document.getElementById(`quantity-${productId}`);
                            const quantity = quantityElement ? parseInt(quantityElement.textContent) : 1;
                            this.addToCart(button, quantity);
                        }
                    }
                });
            }

            updateFreeShippingNotice() {
                const freeShippingNotice = document.getElementById('freeShippingNotice');
                if (freeShippingNotice) {
                    freeShippingNotice.textContent = `Envío bonificado a partir de: $${this.freeShippingThreshold.toLocaleString('es-AR')}`;
                }
            }

            calculateDeliveryDate() {
                const today = new Date();
                const currentDay = today.getDay(); // 0 = domingo, 1 = lunes, ..., 6 = sábado
                
                // Encontrar el próximo día de entrega disponible
                let daysToAdd = 0;
                
                // Buscar el próximo jueves (4) o viernes (5)
                for (let i = 1; i <= 7; i++) {
                    const nextDay = (currentDay + i) % 7;
                    if (this.deliveryDays.includes(nextDay)) {
                        daysToAdd = i;
                        break;
                    }
                }
                
                // Si hoy es jueves o viernes y todavía estamos en horario de entrega
                // Podríamos ofrecer entrega para hoy mismo
                const currentHour = today.getHours();
                const canDeliverToday = this.deliveryDays.includes(currentDay) && currentHour < 20;
                
                if (canDeliverToday) {
                    daysToAdd = 0;
                }
                
                const deliveryDate = new Date(today);
                deliveryDate.setDate(today.getDate() + daysToAdd);
                
                return deliveryDate;
            }

            updateDeliveryDetails() {
                const deliveryLocation = document.getElementById('deliveryLocation');
                const deliveryCity = document.getElementById('deliveryCity');
                const deliveryDay = document.getElementById('deliveryDay');
                const deliveryTime = document.getElementById('deliveryTime');
                const customerCity = document.getElementById('customerCity');
                
                if (deliveryLocation.value) {
                    const selectedOption = deliveryLocation.options[deliveryLocation.selectedIndex];
                    const cityName = selectedOption.text;
                    
                    const deliveryDate = this.calculateDeliveryDate();
                    const dayNames = ['domingo', 'lunes', 'martes', 'miércoles', 'jueves', 'viernes', 'sábado'];
                    const monthNames = ['enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 
                                    'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre'];
                    
                    const dayName = dayNames[deliveryDate.getDay()];
                    const dayNumber = deliveryDate.getDate();
                    const monthName = monthNames[deliveryDate.getMonth()];
                    
                    // Formato más amigable: "jueves 15 de abril"
                    const formattedDate = `${dayName} ${dayNumber} de ${monthName}`;
                    
                    deliveryCity.textContent = cityName.toUpperCase();
                    deliveryDay.textContent = formattedDate.toUpperCase();
                    deliveryTime.textContent = this.deliveryTimeRange.toUpperCase();
                    
                    if (customerCity) {
                        customerCity.value = cityName;
                    }
                }
            }

            addToCartFromModal(product, button) {
                const existingItem = this.cart.find(item => item.id == product.id);
                
                if (existingItem) {
                    existingItem.quantity += product.quantity;
                    button.textContent = '✓ Agregado';
                    button.classList.add('added');
                    setTimeout(() => {
                        button.textContent = `Agregar al Carrito`;
                        button.classList.remove('added');
                    }, 1000);
                } else {
                    this.cart.push({
                        ...product,
                        presentation: product.presentation || window.productSystem.getDefaultPresentation(product.category)
                    });
                    button.textContent = '✓ Agregado';
                    button.classList.add('added');
                    setTimeout(() => {
                        button.textContent = `Agregar al Carrito`;
                        button.classList.remove('added');
                    }, 1000);
                }

                this.saveCart();
                this.renderCart();
                this.updateCartCount();
                
                document.getElementById('cartToggle').classList.add('pulse');
                setTimeout(() => {
                    document.getElementById('cartToggle').classList.remove('pulse');
                }, 300);

                this.openCart();
            }

            addToCart(button, quantity = 1) {
                const product = {
                    id: button.dataset.id,
                    name: button.dataset.name,
                    price: parseInt(button.dataset.price),
                    category: button.dataset.category,
                    presentation: button.dataset.presentation || window.productSystem.getDefaultPresentation(button.dataset.category),
                    quantity: quantity
                };

                const existingItem = this.cart.find(item => item.id == product.id);
                
                if (existingItem) {
                    existingItem.quantity += quantity;
                    button.textContent = '✓ Agregado';
                    button.classList.add('added');
                    setTimeout(() => {
                        button.textContent = 'Agregar al Carrito';
                        button.classList.remove('added');
                    }, 1000);
                } else {
                    this.cart.push(product);
                    button.textContent = '✓ Agregado';
                    button.classList.add('added');
                    setTimeout(() => {
                        button.textContent = 'Agregar al Carrito';
                        button.classList.remove('added');
                    }, 1000);
                }

                this.saveCart();
                this.renderCart();
                this.updateCartCount();
                
                document.getElementById('cartToggle').classList.add('pulse');
                setTimeout(() => {
                    document.getElementById('cartToggle').classList.remove('pulse');
                }, 300);

                this.openCart();
            }

            updateQuantity(id, change) {
                const item = this.cart.find(item => item.id == id);
                if (item) {
                    const oldQuantity = item.quantity;
                    item.quantity += change;
                    
                    if (item.quantity < 1) {
                        this.removeFromCart(id);
                    } else {
                        this.saveCart();
                        this.renderCart();
                        this.updateCartCount();
                        this.validateForm();
                        
                        // Track quantity change event
                        if (window.analyticsSystem && item) {
                            const product = window.productSystem?.products?.find(p => p.id == id);
                            if (product) {
                                window.analyticsSystem.trackEvent(change > 0 ? 'increase_quantity' : 'decrease_quantity', {
                                    product_id: id,
                                    product_name: product.name,
                                    product_category: product.category,
                                    product_price: product.price,
                                    old_quantity: oldQuantity,
                                    new_quantity: item.quantity,
                                    change: change
                                });
                            }
                        }
                    }
                }
            }

            removeFromCart(id) {
                const item = this.cart.find(item => item.id == id);
                if (item) {
                    // Track remove_from_cart event antes de eliminar
                    if (window.analyticsSystem) {
                        const product = window.productSystem?.products?.find(p => p.id == id);
                        if (product) {
                            window.analyticsSystem.trackEvent('remove_from_cart', {
                                product_id: id,
                                product_name: product.name,
                                product_category: product.category,
                                product_price: product.price,
                                quantity: item.quantity,
                                total_value: item.price * item.quantity
                            });
                        }
                    }
                    
                    this.cart = this.cart.filter(item => item.id != id);
                    this.saveCart();
                    this.renderCart();
                    this.updateCartCount();
                    this.validateForm();
                }
            }

            saveCart() {
                localStorage.setItem('elOsoCart', JSON.stringify(this.cart));
            }

            updateCartCount() {
                const count = this.cart.reduce((total, item) => total + item.quantity, 0);
                document.getElementById('cartCount').textContent = count;
            }

            calculateSubtotal() {
                return this.cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            }

            calculateShipping() {
                const subtotal = this.calculateSubtotal();
                if (subtotal >= this.freeShippingThreshold) {
                    return 0;
                }
                return this.shippingCost;
            }

            calculateTotal() {
                return this.calculateSubtotal() + this.calculateShipping();
            }

            renderCart() {
                const cartItems = document.getElementById('cartItems');
                const ticketSummary = document.getElementById('ticketSummary');
                const cartItemsContainer = document.getElementById('cartItemsContainer');
                
                if (this.cart.length === 0) {
                    cartItems.innerHTML = `
                        <div class="cart-empty">
                            <p>Tu carrito está vacío</p>
                            <p>¡Agrega algunos productos para comenzar!</p>
                        </div>
                    `;
                    ticketSummary.style.display = 'none';
                    document.getElementById('checkoutBtn').disabled = true;
                    cartItemsContainer.classList.remove('hidden');
                    return;
                }

                let itemsHTML = '';
                
                this.cart.forEach((item, index) => {
                    const itemTotal = item.price * item.quantity;
                    const presentation = item.presentation || window.productSystem.getDefaultPresentation(item.category);
                    
                    itemsHTML += `
                        <div class="ticket-item" data-id="${item.id}">
                            <div class="item-info">
                                <div class="item-header">
                                    <div class="item-name">${index+1}. ${item.name.split(' - ')[0]} / ${presentation}</div>
                                    <div class="item-price">$ ${item.price.toLocaleString('es-AR')} /U.</div>
                                </div>
                                <div class="item-controls">
                                    <div class="item-details">CANTIDAD: </div>
                                    <div class="quantity-controls">
                                        <button class="quantity-btn quantity-decrease">-</button>
                                        <span class="quantity-display">${item.quantity}</span>
                                        <button class="quantity-btn quantity-increase">+</button>
                                    </div>
                                    <div class="remove-item">ELIMINAR</div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                cartItems.innerHTML = itemsHTML;
                ticketSummary.style.display = 'block';
                cartItemsContainer.classList.remove('hidden');
                
                this.updateSummary();
                this.validateForm();
                
                if (document.getElementById('deliveryLocation').value) {
                    this.updateDeliveryDetails();
                }
            }

            updateSummary() {
                const subtotal = this.calculateSubtotal();
                const shipping = this.calculateShipping();
                const total = this.calculateTotal();
                
                document.getElementById('cartSubtotal').textContent = `$ ${subtotal.toLocaleString('es-AR')}`;
                document.getElementById('cartShipping').textContent = shipping === 0 ? '$ 0' : `$ ${shipping.toLocaleString('es-AR')}`;
                document.getElementById('cartTotal').textContent = `$ ${total.toLocaleString('es-AR')}`;
                
                const freeShippingNotice = document.getElementById('freeShippingNotice');
                if (subtotal < this.freeShippingThreshold) {
                    freeShippingNotice.style.display = 'block';
                } else {
                    freeShippingNotice.style.display = 'none';
                }
            }

            validateField(fieldId, value) {
                const field = document.getElementById(fieldId);
                let errorElement = document.getElementById(`${fieldId}Error`);
                
                if (!errorElement && field) {
                    errorElement = document.createElement('div');
                    errorElement.id = `${fieldId}Error`;
                    errorElement.className = 'error-message';
                    field.parentNode.appendChild(errorElement);
                }
                
                let isValid = true;
                let errorMessage = '';
                
                if (field) {
                    field.classList.remove('error', 'valid');
                }
                if (errorElement) {
                    errorElement.classList.remove('show');
                }
                
                switch(fieldId) {
                    case 'customerName':
                        if (!value.trim()) {
                            isValid = false;
                            errorMessage = 'El nombre es requerido';
                        } else if (value.trim().length < 2) {
                            isValid = false;
                            errorMessage = 'El nombre debe tener al menos 2 caracteres';
                        }
                        break;
                        
                    case 'customerDNI':
                        const dniDigits = value.replace(/\D/g, '');
                        if (!value.trim()) {
                            isValid = false;
                            errorMessage = 'El DNI es requerido';
                        } else if (dniDigits.length < 7 || dniDigits.length > 8) {
                            isValid = false;
                            errorMessage = 'El DNI debe tener 7 u 8 dígitos';
                        } else if (!/^\d+$/.test(dniDigits)) {
                            isValid = false;
                            errorMessage = 'El DNI debe contener solo números';
                        }
                        break;
                        
                    case 'customerEmail':
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!value.trim()) {
                            isValid = false;
                            errorMessage = 'El email es requerido';
                        } else if (!emailRegex.test(value)) {
                            isValid = false;
                            errorMessage = 'Ingrese un email válido';
                        }
                        break;
                        
                    case 'customerPhone':
                        const phoneDigits = value.replace(/\D/g, '');
                        if (!value.trim()) {
                            isValid = false;
                            errorMessage = 'El teléfono es requerido';
                        } else if (phoneDigits.length < 10 || phoneDigits.length > 11) {
                            isValid = false;
                            errorMessage = 'El teléfono debe tener 10 u 11 dígitos';
                        }
                        break;
                        
                    case 'customerAddress':
                        if (!value.trim()) {
                            isValid = false;
                            errorMessage = 'La dirección es requerida';
                        } else if (value.trim().length < 5) {
                            isValid = false;
                            errorMessage = 'La dirección debe tener al menos 5 caracteres';
                        }
                        break;
                        
                    case 'deliveryLocation':
                        if (!value) {
                            isValid = false;
                            errorMessage = 'Seleccione una localidad';
                        }
                        break;
                }
                
                if (!isValid && value !== '') {
                    if (field) {
                        field.classList.add('error');
                    }
                    if (errorElement) {
                        errorElement.textContent = errorMessage;
                        errorElement.classList.add('show');
                    }
                } else if (isValid && value !== '' && field) {
                    field.classList.add('valid');
                }
                
                return isValid;
            }

            validateAllFields() {
                const fields = [
                    { id: 'customerName', value: document.getElementById('customerName').value },
                    { id: 'customerDNI', value: document.getElementById('customerDNI').value },
                    { id: 'customerEmail', value: document.getElementById('customerEmail').value },
                    { id: 'customerPhone', value: document.getElementById('customerPhone').value },
                    { id: 'customerAddress', value: document.getElementById('customerAddress').value },
                    { id: 'deliveryLocation', value: document.getElementById('deliveryLocation').value }
                ];
                
                let allValid = true;
                
                fields.forEach(field => {
                    if (!this.validateField(field.id, field.value)) {
                        allValid = false;
                    }
                });
                
                return allValid;
            }

            validateForm() {
                const checkoutBtn = document.getElementById('checkoutBtn');
                
                if (this.cart.length === 0) {
                    checkoutBtn.disabled = true;
                    return false;
                }
                
                const formIsValid = this.validateAllFields();
                const customerCity = document.getElementById('customerCity').value;
                const cityValid = customerCity.trim() !== '';
                
                checkoutBtn.disabled = !(formIsValid && cityValid);
                
                return formIsValid && cityValid;
            }

            resetFormErrors() {
                const errorMessages = document.querySelectorAll('.error-message');
                errorMessages.forEach(error => {
                    error.classList.remove('show');
                    error.textContent = '';
                });
                
                const errorFields = document.querySelectorAll('.form-input.error, .form-textarea.error, .shipping-select.error');
                errorFields.forEach(field => {
                    field.classList.remove('error');
                });
                
                const validFields = document.querySelectorAll('.form-input.valid, .form-textarea.valid');
                validFields.forEach(field => {
                    field.classList.remove('valid');
                });
            }

            openCart() {
                document.getElementById('cartSidebar').classList.add('active');
                document.getElementById('cartOverlay').classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            closeCart() {
                this.resetToCartView();
                document.getElementById('cartSidebar').classList.remove('active');
                document.getElementById('cartOverlay').classList.remove('active');
                document.body.style.overflow = 'auto';
                this.resetFormErrors();
            }

            resetToCartView() {
                const confirmation = document.getElementById('orderConfirmation');
                if (confirmation) {
                    confirmation.classList.remove('active');
                }
                
                const cartContainer = document.getElementById('cartItemsContainer');
                if (cartContainer) {
                    cartContainer.classList.remove('hidden');
                }
            }

            async submitOrderToGoogleForm(orderData) {
                
                try {
                    const formData = {
                        action: 'submitOrder',
                        orderData: orderData
                    };

                    const response = await fetch(this.APPS_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'cors',
                        //headers: { 'Content-Type': 'application/json', },
                        body: JSON.stringify(formData)
                    });

                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }

                    const result = await response.json();
            
                    if (!result.success) {
                        throw new Error(result.message || 'Error del servidor al procesar el pedido');
                    }
            
                    return result;
                } catch (error) {
                    console.error('❌ Error enviando pedido a Google Apps Script:', error);
                    
                    return {
                        success: false,
                        orderId: orderData.orderNumber,
                        error: error.message,
                        message: 'Error de red al enviar el pedido'
                    };
                }
            }

            async checkout() {
                
                if (!this.validateAllFields()) {
                    return;
                }
                
                const customerData = {
                    name: document.getElementById('customerName').value.trim(),
                    dni: document.getElementById('customerDNI').value.trim(),
                    email: document.getElementById('customerEmail').value.trim(),
                    phone: document.getElementById('customerPhone').value.trim(),
                    address: document.getElementById('customerAddress').value.trim(),
                    city: document.getElementById('customerCity').value.trim(),
                    location: document.getElementById('deliveryLocation').value,
                    deliveryDay: document.getElementById('deliveryDay').textContent,
                    deliveryTime: '11 a 20 hrs',
                    notes: document.getElementById('orderNotes').value.trim()
                };
                
                const order = {
                    timestamp: new Date().toISOString(),
                    orderNumber: 'ELO-' + Date.now().toString().slice(-8),
                    customer: customerData,
                    items: this.cart,
                    subtotal: this.calculateSubtotal(),
                    shipping: this.calculateShipping(),
                    total: this.calculateTotal(),
                    shippingType: 'delivery',
                    status: 'pending'
                };
                
                const checkoutBtn = document.getElementById('checkoutBtn');
                const originalText = checkoutBtn.textContent;
                checkoutBtn.textContent = 'ENVIANDO...';
                checkoutBtn.disabled = true;
                
                try {
                    const result = await this.submitOrderToGoogleForm(order);

                    if (result.success) {
                        this.saveOrderToLocalStorage(order);
                        this.showOrderConfirmation(order, result);
                        this.cart = [];
                        this.saveCart();
                        this.updateCartCount();
                        this.resetForm();
                        cartItems.innerHTML = `
                            <div class="cart-empty">
                                <p>Tu carrito está vacío</p>
                                <p>¡Agrega algunos productos para comenzar!</p>
                            </div>
                        `;
                    } else {
                        this.showOrderError(result);
                        checkoutBtn.textContent = originalText;
                        checkoutBtn.disabled = false;
                        return;
                    }
                } catch (error) {
                    this.showConnectionError(error);
                    checkoutBtn.textContent = originalText;
                    checkoutBtn.disabled = false;
                    return; // No continuar con el proceso
                }
            }

            // Método para mostrar errores de conexión
            showConnectionError(error) {
                const cartItemsContainer = document.getElementById('cartItemsContainer');
                const errorHTML = `
                    <div class="ticket-section" style="text-align: center; padding: 40px 20px;">
                        <div style="color: #ff3131; font-size: 4rem; margin-bottom: 20px;">⚠️</div>
                        <h3 style="color: #333; margin-bottom: 15px;">Error de conexión</h3>
                        <p style="color: #666; margin-bottom: 20px;">
                            No pudimos conectar con el servidor. Por favor, verifica tu conexión a internet e inténtalo de nuevo.
                        </p>
                        <p style="color: #888; font-size: 0.9rem; margin-bottom: 25px;">
                            <strong>Detalles técnicos:</strong> ${error.message || 'Error de red'}
                        </p>
                        <button id="retryCheckoutBtn" class="checkout-btn" style="background: #ff3131;">
                            REINTENTAR ENVÍO
                        </button>
                        <p style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                            O puedes contactarnos directamente por WhatsApp para completar tu pedido.
                        </p>
                    </div>
                `;
                
                cartItemsContainer.innerHTML = errorHTML;
                
                // Configurar botón de reintento
                document.getElementById('retryCheckoutBtn').addEventListener('click', () => {
                    this.checkout();
                });
            }

            // Método para mostrar errores del servidor
            showOrderError(result) {
                const cartItemsContainer = document.getElementById('cartItemsContainer');
                const errorHTML = `
                    <div class="ticket-section" style="text-align: center; padding: 40px 20px;">
                        <div style="color: #ff3131; font-size: 4rem; margin-bottom: 20px;">❌</div>
                        <h3 style="color: #333; margin-bottom: 15px;">Error al procesar el pedido</h3>
                        <p style="color: #666; margin-bottom: 20px;">
                            ${result.message || 'Hubo un problema al procesar tu pedido. Por favor, inténtalo de nuevo.'}
                        </p>
                        <button id="retryCheckoutBtn" class="checkout-btn" style="background: #ff3131;">
                            REINTENTAR
                        </button>
                        <p style="margin-top: 20px; font-size: 0.9rem; color: #666;">
                            Si el problema persiste, contáctanos por WhatsApp para ayudarte con tu pedido.
                        </p>
                    </div>
                `;
                
                cartItemsContainer.innerHTML = errorHTML;
                
                // Configurar botón de reintento
                document.getElementById('retryCheckoutBtn').addEventListener('click', () => {
                    this.checkout();
                });
            }

            saveOrderToLocalStorage(order) {
                try {
                    const sentOrders = JSON.parse(localStorage.getItem('elOsoSentOrders') || '[]');
                    sentOrders.push({
                        ...order,
                        savedAt: new Date().toISOString(),
                        sent: true
                    });
                    localStorage.setItem('elOsoSentOrders', JSON.stringify(sentOrders));
                    
                    return true;
                } catch (error) {
                    console.error('Error guardando pedido:', error);
                    return false;
                }
            }

            showOrderConfirmation(order, response) {
                const customerData = {
                    name: document.getElementById('customerName').value.trim(),
                    dni: document.getElementById('customerDNI').value.trim(),
                    email: document.getElementById('customerEmail').value.trim(),
                    phone: document.getElementById('customerPhone').value.trim(),
                    address: document.getElementById('customerAddress').value.trim(),
                    city: document.getElementById('customerCity').value.trim(),
                    deliveryDay: document.getElementById('deliveryDay').textContent,
                    deliveryTime: '11 a 20 hrs'
                };

                document.getElementById('cartItemsContainer').classList.add('hidden');
                document.getElementById('orderConfirmation').classList.add('active');

                const productsListContainer = document.getElementById('confirmationProductsList');
                if (productsListContainer) {
                    let productsHTML = '';
                    
                    order.items.forEach((item, index) => {
                        const itemTotal = item.price * item.quantity;
                        const presentation = item.presentation || window.productSystem.getDefaultPresentation(item.category);
                        
                        productsHTML += `
                            <div class="confirmation-product-item">
                                <div class="product-item-info">
                                    <div class="product-item-name">${index + 1}. ${item.name.split(' - ')[0]} (${presentation}) x ${item.quantity}</div>
                                </div>
                                <div class="product-item-total">
                                    $ ${itemTotal.toLocaleString('es-AR')}
                                </div>
                            </div>
                        `;
                    });
                    
                    productsListContainer.innerHTML = productsHTML;
                }

                document.getElementById('confirmationOrderNumber').textContent = order.orderNumber;
                document.getElementById('confirmationName').textContent = customerData.name;
                document.getElementById('confirmationPhone').textContent = customerData.phone;
                document.getElementById('confirmationEmail').textContent = customerData.email;
                document.getElementById('confirmationDNI').textContent = customerData.dni;
                document.getElementById('confirmationAddress').textContent = customerData.address;
                document.getElementById('confirmationCity').textContent = customerData.city;
                document.getElementById('confirmationDelivery').textContent = `${customerData.deliveryDay} (${customerData.deliveryTime})`;
                document.getElementById('confirmationSubtotal').textContent = `$ ${order.subtotal.toLocaleString('es-AR')}`;
                document.getElementById('confirmationShipping').textContent = order.shipping === 0 ? '$ 0' : `$ ${order.shipping.toLocaleString('es-AR')}`;
                document.getElementById('confirmationTotal').textContent = `$ ${order.total.toLocaleString('es-AR')}`;

                const whatsappBtn = document.getElementById('whatsappConfirmBtn');
                if (whatsappBtn) {
                    const itemsList = order.items.map(item => 
                        `${item.name} (${item.presentation || window.productSystem.getDefaultPresentation(item.category)}) x${item.quantity} - $${(item.price * item.quantity).toLocaleString('es-AR')}`
                    ).join('%0A');
                    
                    const message = `*NUEVO PEDIDO EL OSO*%0A%0A` +
                                `*Pedido:* ${order.orderNumber}%0A` +
                                `*Cliente:* ${customerData.name}%0A` +
                                `*Teléfono:* ${customerData.phone}%0A` +
                                `*DNI:* ${customerData.dni}%0A` +
                                `*Dirección:* ${customerData.address}, ${customerData.city}%0A` +
                                `*Entrega:* ${customerData.deliveryDay} (11 a 20 hrs)%0A%0A` +
                                `*Productos:*%0A${itemsList}%0A%0A` +
                                `*Subtotal:* $${order.subtotal.toLocaleString('es-AR')}%0A` +
                                `*Envío:* $${order.shipping.toLocaleString('es-AR')}%0A` +
                                `*TOTAL:* $${order.total.toLocaleString('es-AR')}%0A%0A` +
                                `_Pedido realizado desde la web_`;
                    
                    whatsappBtn.href = `https://wa.me/5491123495971?text=${encodeURIComponent(message)}`;
                    
                    whatsappBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        window.open(whatsappBtn.href, '_blank');
                    });
                }

                const confirmationBody = document.querySelector('.confirmation-body');
                
                const warningDiv = document.createElement('div');
                warningDiv.className = 'warning-box';
                warningDiv.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#856404" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
                        </svg>
                        <strong style="font-size: 1.1rem;">¡IMPORTANTE! DEBES CONFIRMAR TU PEDIDO</strong>
                    </div>
                    <p style="margin-bottom: 10px;">Este pedido fue guardado localmente. Para que sea procesado:</p>
                    <ul style="padding-left: 20px; margin-bottom: 15px;">
                        <li>Haz clic en el botón verde de WhatsApp</li>
                        <li>Envía el mensaje automático que se abrirá</li>
                        <li>Espera nuestra confirmación por WhatsApp</li>
                    </ul>
                    <p><strong>Si no confirmas, tu pedido no será procesado.</strong></p>
                `;
                
                const summarySection = confirmationBody.querySelector('.confirmation-section:nth-child(3)');
                if (summarySection) {
                    summarySection.after(warningDiv);
                }

                document.querySelector('.order-confirmation').scrollTop = 0;
            }

            resetForm() {
                document.getElementById('deliveryLocation').value = '';
                document.getElementById('deliveryCity').textContent = '';
                document.getElementById('deliveryDay').textContent = '';
                document.getElementById('deliveryTime').textContent = '';
                document.getElementById('customerName').value = '';
                document.getElementById('customerDNI').value = '';
                document.getElementById('customerEmail').value = '';
                document.getElementById('customerPhone').value = '';
                document.getElementById('customerAddress').value = '';
                document.getElementById('customerCity').value = '';
                document.getElementById('orderNotes').value = '';
                this.resetFormErrors();
            }
        }

        // ====== ANALYTICS Y CONVERSION TRACKING ======
        class AnalyticsSystem {
            constructor() {
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.trackPageView();
            }

            trackPageView() {
                if (typeof gtag !== 'undefined') {
                    gtag('event', 'page_view', {
                        page_title: document.title,
                        page_location: window.location.href,
                        page_path: window.location.pathname
                    });
                }
            }

            trackEvent(eventName, eventParams = {}) {
                // Google Analytics
                if (typeof gtag !== 'undefined') {
                    gtag('event', eventName, eventParams);
                }
                
                // Microsoft Clarity
                if (typeof clarity !== 'undefined') {
                    clarity('set', eventName, eventParams);
                }
                
                //console.log(`📊 Analytics Event: ${eventName}`, eventParams);
            }

            setupEventListeners() {
                // 1. Categorías de productos
                document.addEventListener('click', (e) => {
                    if (e.target.closest('.btn-white-border[data-filter]')) {
                        const button = e.target.closest('.btn-white-border[data-filter]');
                        const filter = button.getAttribute('data-filter');
                        
                        this.trackEvent('select_filter', {
                            filter_category: filter,
                            button_text: button.textContent.trim()
                        });
                    }
                });

                // 2. Vista de producto en modal
                document.addEventListener('click', (e) => {
                    if (e.target.classList.contains('product-image')) {
                        const productId = e.target.dataset.id;
                        const product = window.productSystem?.products?.find(p => p.id == productId);
                        
                        if (product) {
                            this.trackEvent('view_product', {
                                product_id: product.id,
                                product_name: product.name,
                                product_category: product.category,
                                product_price: product.price
                            });
                        }
                    }
                });

                // 3. Agregar al carrito DESDE LISTADO DE PRODUCTOS
                document.addEventListener('click', (e) => {
                    const addToCartBtn = e.target.closest('.btn-add-cart');
                    if (addToCartBtn && !addToCartBtn.disabled && !addToCartBtn.classList.contains('modal-add-to-cart-btn')) {
                        const productId = addToCartBtn.dataset.id;
                        const product = window.productSystem?.products?.find(p => p.id == productId);
                        
                        if (product) {
                            const quantity = parseInt(document.getElementById(`quantity-${productId}`)?.textContent) || 1;
                            
                            this.trackEvent('add_to_cart', {
                                product_id: product.id,
                                product_name: product.name,
                                product_category: product.category,
                                product_price: product.price,
                                currency: 'ARS',
                                quantity: quantity,
                                source: 'list'
                            });
                        }
                    }
                });

                // 4. Abrir carrito
                document.addEventListener('click', (e) => {
                    if (e.target.closest('#cartToggle')) {
                        this.trackEvent('view_cart', {
                            cart_count: window.cartSystem?.cart?.length || 0,
                            cart_value: window.cartSystem?.calculateSubtotal() || 0
                        });
                    }
                });

                // 5. Inicio de checkout
                document.addEventListener('click', (e) => {
                    if (e.target.closest('#checkoutBtn') && !e.target.closest('#checkoutBtn').disabled) {
                        this.trackEvent('begin_checkout', {
                            cart_count: window.cartSystem?.cart?.length || 0,
                            subtotal: window.cartSystem?.calculateSubtotal() || 0,
                            shipping: window.cartSystem?.calculateShipping() || 0,
                            total: window.cartSystem?.calculateTotal() || 0,
                            items: window.cartSystem?.cart?.map(item => ({
                                item_id: item.id,
                                item_name: item.name,
                                quantity: item.quantity
                            })) || []
                        });
                    }
                });

                // 6. Pedido completado - Modificado para incluir eventos de carrito
                const originalShowOrderConfirmation = window.cartSystem?.showOrderConfirmation;
                if (originalShowOrderConfirmation) {
                    window.cartSystem.showOrderConfirmation = function(order, response) {
                        // Track purchase event
                        if (window.analyticsSystem) {
                            window.analyticsSystem.trackEvent('purchase', {
                                transaction_id: order.orderNumber,
                                value: order.total,
                                currency: 'ARS',
                                tax: 0,
                                shipping: order.shipping,
                                items: order.items.map(item => ({
                                    item_id: item.id,
                                    item_name: item.name,
                                    item_category: item.category,
                                    price: item.price,
                                    quantity: item.quantity
                                }))
                            });
                        }
                        
                        // Call original function
                        return originalShowOrderConfirmation.call(this, order, response);
                    };
                }

                // 7. Clics en WhatsApp
                document.addEventListener('click', (e) => {
                    const whatsappBtn = e.target.closest('a[href*="wa.me"]');
                    if (whatsappBtn) {
                        this.trackEvent('contact_whatsapp', {
                            source: whatsappBtn.textContent.trim(),
                            href: whatsappBtn.getAttribute('href')
                        });
                    }
                });

                // 8. Clics en redes sociales
                document.addEventListener('click', (e) => {
                    const socialBtn = e.target.closest('a[href*="instagram.com"], a[href*="facebook.com"]');
                    if (socialBtn) {
                        const platform = socialBtn.getAttribute('href').includes('instagram.com') ? 'instagram' : 'facebook';
                        this.trackEvent('social_click', {
                            platform: platform,
                            button_text: socialBtn.textContent.trim()
                        });
                    }
                });

                // 9. Clics en reseñas de Google Maps
                document.addEventListener('click', (e) => {
                    const reviewsBtn = e.target.closest('a[href*="maps.app.goo.gl"]');
                    if (reviewsBtn) {
                        this.trackEvent('view_reviews', {
                            source: 'google_maps'
                        });
                    }
                });

                // 10. Scroll por secciones (Intersection Observer)
                this.setupSectionTracking();
            }

            setupSectionTracking() {
                const sections = ['#tienda', '#resenas', '#somos', '#contacto'];
                
                const observerOptions = {
                    root: null,
                    rootMargin: '0px',
                    threshold: 0.3
                };

                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const sectionId = entry.target.id;
                            this.trackEvent('view_section', {
                                section_name: sectionId,
                                section_title: entry.target.querySelector('h1')?.textContent || sectionId
                            });
                            
                            // Dejar de observar después de que se haya visto
                            observer.unobserve(entry.target);
                        }
                    });
                }, observerOptions);

                sections.forEach(sectionId => {
                    const section = document.querySelector(sectionId);
                    if (section) observer.observe(section);
                });
            }

            // Método para tracking de errores de formulario
            trackFormError(field, error) {
                this.trackEvent('form_error', {
                    field_name: field,
                    error_message: error
                });
            }

            // Método para tracking de tiempo en página
            setupTimeTracking() {
                let startTime = Date.now();
                
                window.addEventListener('beforeunload', () => {
                    const timeSpent = Date.now() - startTime;
                    const timeInSeconds = Math.round(timeSpent / 1000);
                    
                    this.trackEvent('time_on_page', {
                        time_seconds: timeInSeconds,
                        page_path: window.location.pathname
                    });
                });
            }
        }

        // ====== PORTAL DE BIENVENIDA CON NIEVE INTERACTIVA ======
        class WelcomePortal {
            constructor() {
                this.portal = document.getElementById('welcomePortal');
                this.confirmBtn = document.getElementById('portalConfirmBtn');
                this.denyBtn = document.getElementById('portalDenyBtn');
                this.ageVerified = localStorage.getItem('elOsoAgeVerified');
                this.snowCanvas = document.getElementById('snowCanvas');
                this.snowParticles = [];
                this.mouseX = 0;
                this.mouseY = 0;
                this.mouseRadius = 100;
                this.init();
            }

            init() {
                // Mostrar portal solo si no ha verificado edad antes
                if (!this.ageVerified) {
                    this.showPortal();
                    this.initSnow();
                    this.setupMouseTracking();
                } else {
                    this.hidePortal();
                }

                this.setupEventListeners();
            }

            initSnow() {
                if (!this.snowCanvas) return;
                
                const canvas = this.snowCanvas;
                const ctx = canvas.getContext('2d');
                
                // Ajustar tamaño del canvas
                const resizeCanvas = () => {
                    canvas.width = canvas.parentElement.clientWidth;
                    canvas.height = canvas.parentElement.clientHeight;
                };
                
                resizeCanvas();
                window.addEventListener('resize', resizeCanvas);
                
                // Crear partículas de nieve
                const particleCount = Math.min(150, Math.floor((canvas.width * canvas.height) / 5000));
                
                for (let i = 0; i < particleCount; i++) {
                    this.snowParticles.push({
                        x: Math.random() * canvas.width,
                        y: Math.random() * canvas.height,
                        size: Math.random() * 4 + 1,
                        speed: Math.random() * 1 + 0.5,
                        sway: Math.random() * 0.5 + 0.1,
                        swayAngle: Math.random() * Math.PI * 2,
                        opacity: Math.random() * 0.5 + 0.3,
                        wind: (Math.random() - 0.5) * 0.2
                    });
                }
                
                // Función de animación
                const animateSnow = () => {
                    if (!this.portal || !this.portal.classList.contains('active')) {
                        return;
                    }
                    
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    
                    // Actualizar y dibujar partículas
                    this.snowParticles.forEach(particle => {
                        // Movimiento natural
                        particle.y += particle.speed;
                        particle.swayAngle += particle.sway * 0.05;
                        particle.x += Math.sin(particle.swayAngle) * 0.3 + particle.wind;
                        
                        // Efecto del mouse
                        const dx = particle.x - this.mouseX;
                        const dy = particle.y - this.mouseY;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < this.mouseRadius) {
                            const force = (this.mouseRadius - distance) / this.mouseRadius;
                            particle.x += (dx / distance) * force * 3;
                            particle.y += (dy / distance) * force * 3;
                        }
                        
                        // Reiniciar partículas que salen de la pantalla
                        if (particle.y > canvas.height) {
                            particle.y = -10;
                            particle.x = Math.random() * canvas.width;
                        }
                        
                        if (particle.x > canvas.width + 10) {
                            particle.x = -10;
                        } else if (particle.x < -10) {
                            particle.x = canvas.width + 10;
                        }
                        
                        // Dibujar partícula
                        ctx.beginPath();
                        ctx.fillStyle = `rgba(255, 255, 255, ${particle.opacity})`;
                        ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                        ctx.fill();
                        
                        // Añadir efecto de brillo suave
                        ctx.beginPath();
                        ctx.fillStyle = `rgba(255, 255, 255, ${particle.opacity * 0.3})`;
                        ctx.arc(particle.x, particle.y, particle.size * 1.5, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    
                    requestAnimationFrame(animateSnow);
                };
                
                animateSnow();
            }

            setupMouseTracking() {
                if (!this.snowCanvas) return;
                
                const canvas = this.snowCanvas;
                
                canvas.addEventListener('mousemove', (e) => {
                    const rect = canvas.getBoundingClientRect();
                    this.mouseX = e.clientX - rect.left;
                    this.mouseY = e.clientY - rect.top;
                });
                
                canvas.addEventListener('mouseleave', () => {
                    this.mouseX = -1000;
                    this.mouseY = -1000;
                });
                
                // Permitir interacción táctil en móviles
                canvas.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                    const rect = canvas.getBoundingClientRect();
                    this.mouseX = e.touches[0].clientX - rect.left;
                    this.mouseY = e.touches[0].clientY - rect.top;
                }, { passive: false });
            }

            showPortal() {
                if (this.portal) {
                    document.body.classList.add('portal-active');
                    
                    setTimeout(() => {
                        this.portal.classList.add('active');
                    }, 300);
                }
            }

            hidePortal() {
                if (this.portal) {
                    this.portal.classList.remove('active');
                    
                    setTimeout(() => {
                        document.body.classList.remove('portal-active');
                        this.portal.style.display = 'none';
                        
                        // Limpiar partículas
                        this.snowParticles = [];
                    }, 300);
                }
            }

            verifyAge(isAdult) {
                if (isAdult) {
                    localStorage.setItem('elOsoAgeVerified', 'true');
                    this.hidePortal();
                    
                    if (window.analyticsSystem) {
                        window.analyticsSystem.trackEvent('age_verified', {
                            verified: true,
                            timestamp: new Date().toISOString()
                        });
                    }
                }
            }

            setupEventListeners() {
                if (this.confirmBtn) {
                    this.confirmBtn.addEventListener('click', () => {
                        this.verifyAge(true);
                    });
                }

                if (this.denyBtn) {
                    this.denyBtn.addEventListener('click', () => {
                        this.verifyAge(false);
                    });
                }

                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.portal.classList.contains('active')) {
                        this.verifyAge(false);
                    }
                });
            }
        }

        // ====== INICIALIZACIÓN ======
        document.addEventListener('DOMContentLoaded', async function() {
            var swiperReviews = new Swiper('.mySwiperReviews', {
                slidesPerView: 2,
                spaceBetween: 30,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                breakpoints: {
                    320: { slidesPerView: 1, spaceBetween: 15 },
                    768: { slidesPerView: 1, spaceBetween: 20 },
                    1024: { slidesPerView: 2, spaceBetween: 30 }
                }
            });

            var swiper3 = new Swiper('.mySwiper3', {
                slidesPerView: 1,
                spaceBetween: 0,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                }
            });

            var swiper4 = new Swiper('.mySwiper4', {
                slidesPerView: 1,
                spaceBetween: 0,
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                }
            });

            document.querySelectorAll('form').forEach(form => {
                if (!form.classList.contains('card-mail')) {
                    form.addEventListener('submit', function(e) {
                        e.preventDefault();
                    });
                }
            });

            // Inicializar sistema de productos
            window.productSystem = new ProductSystem();
            
            // Esperar a que se carguen los productos
            await window.productSystem.init();
            
            // Inicializar carrito
            window.cartSystem = new CartSystem();
            
            // Inicializar sistema de analytics
            window.analyticsSystem = new AnalyticsSystem();
            
            // Configurar tracking de tiempo
            window.analyticsSystem.setupTimeTracking();
            
            // Track initial page view with some delay to ensure GA is loaded
            setTimeout(() => {
                window.analyticsSystem.trackPageView();
            }, 1000);
            
            // Track product load
            if (window.productSystem) {
                const productLoadInterval = setInterval(() => {
                    if (window.productSystem.products && window.productSystem.products.length > 0) {
                        window.analyticsSystem.trackEvent('products_loaded', {
                            product_count: window.productSystem.products.length,
                            active_products: window.productSystem.products.filter(p => p.active).length
                        });
                        clearInterval(productLoadInterval);
                    }
                }, 500);
            }
            
            // Track form validation errors
            if (window.cartSystem) {
                const originalValidateField = window.cartSystem.validateField;
                if (originalValidateField) {
                    window.cartSystem.validateField = function(fieldId, value) {
                        const result = originalValidateField.call(this, fieldId, value);
                        
                        // Si hay un error, trackearlo
                        const errorElement = document.getElementById(`${fieldId}Error`);
                        if (errorElement && errorElement.classList.contains('show')) {
                            window.analyticsSystem?.trackFormError(fieldId, errorElement.textContent);
                        }
                        
                        return result;
                    };
                }
            }
            
            // Configurar eventos del carrito
            document.getElementById('cartToggle').addEventListener('click', () => window.cartSystem.openCart());
            document.getElementById('closeCart').addEventListener('click', () => window.cartSystem.closeCart());
            document.getElementById('cartOverlay').addEventListener('click', () => window.cartSystem.closeCart());
            
            // Select de localidad
            document.getElementById('deliveryLocation').addEventListener('change', (e) => {
                window.cartSystem.validateField('deliveryLocation', e.target.value);
                window.cartSystem.updateDeliveryDetails();
                window.cartSystem.validateForm();
            });

            // Validación en tiempo real
            const formFields = ['customerName', 'customerDNI', 'customerEmail', 'customerPhone', 'customerAddress'];
            
            formFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('blur', (e) => {
                        window.cartSystem.validateField(fieldId, e.target.value);
                        window.cartSystem.validateForm();
                    });
                    
                    let timeout;
                    field.addEventListener('input', (e) => {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => {
                            window.cartSystem.validateField(fieldId, e.target.value);
                            window.cartSystem.validateForm();
                        }, 500);
                    });
                }
            });

            // Checkout
            document.getElementById('checkoutBtn').addEventListener('click', () => window.cartSystem.checkout());
        });

        // Animación de spinner
        const style = document.createElement('style');
        style.textContent = `
            @keyframes spin {
                to { transform: rotate(360deg); }
            }
        `;
        document.head.appendChild(style);

        // Inicializar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar portal con nieve
            window.welcomePortal = new WelcomePortal();
        });
    </script>
</body>
</html>