const CONFIG={SHEET_ID:'2PACX-1vTy8faJa3rHsf2msyB-OH5zyOD9WTD40Ry1O_Jng3p29Z6-58SCNw2KH14y1mr66JoDAkBVQDIXZv8q',GID:'1302727963',FREE_SHIPPING_THRESHOLD:15000,FREE_SHIPPING_DAYS:[4,5],FREE_SHIPPING_HOUR:18,PROXIES:['https://api.allorigins.win/raw?url=','https://corsproxy.io/?','https://cors-anywhere.herokuapp.com/']};class ElOsoApp{constructor(){this.products={flash:[],mostSold:[],beers:[],sauces:[],preserves:[],combos:[]};this.cart=[];this.currentSearchTerm='';this.managers={}}
async init(){try{this.setupManagers();await this.loadProducts();this.setupEventListeners();this.startCountdowns();this.loadCart();this.updateCartUI();console.log('üõí El Oso - Ecommerce inicializado correctamente')}catch(error){console.error('‚ùå Error inicializando la app:',error)}}
setupManagers(){this.managers={analytics:new GoogleAnalyticsTracker(),forms:new GoogleFormsManager(),social:new SocialProof(),ui:new UIManager(this),cart:new CartManager(this),products:new ProductManager(this)}}
async loadProducts(){await this.managers.products.loadProducts()}
loadCart(){this.cart=this.managers.cart.loadCart()}
updateCartUI(){this.managers.cart.updateCartUI()}
startCountdowns(){this.managers.ui.startCountdown();this.managers.ui.startShippingCountdown();this.managers.ui.startCompactShippingCountdown()}
getProductById(id){return this.managers.products.getProductById(id)}
addToCart(productId,button=null){this.managers.cart.addToCart(productId,button)}
removeFromCart(productId){this.managers.cart.removeFromCart(productId)}
updateCartQuantity(productId,change){this.managers.cart.updateCartQuantity(productId,change)}
setupEventListeners(){this.setupMenuEventListeners();this.setupSearchEventListeners();this.setupCartEventListeners();this.setupModalEventListeners();this.setupNavigationEventListeners();this.setupGlobalEventListeners()}
setupMenuEventListeners(){const menuToggle=document.getElementById('menuToggle');const mobileMenu=document.getElementById('mobileMenu');const closeMenu=document.getElementById('closeMenu');const overlay=document.getElementById('overlay');if(menuToggle){menuToggle.addEventListener('click',()=>{mobileMenu.classList.add('active');overlay.classList.add('active');document.body.style.overflow='hidden';if(this.managers.analytics){this.managers.analytics.trackMenuInteraction('mobile_menu')}})}
if(closeMenu){closeMenu.addEventListener('click',()=>{mobileMenu.classList.remove('active');overlay.classList.remove('active');document.body.style.overflow=''})}}
setupSearchEventListeners(){const searchToggle=document.getElementById('searchToggle');const searchBar=document.getElementById('searchBar');const searchInput=document.getElementById('searchInput');const searchClose=document.getElementById('searchClose');if(searchToggle){searchToggle.addEventListener('click',()=>{searchBar.classList.add('active');setTimeout(()=>searchInput?.focus(),300);if(this.managers.analytics){this.managers.analytics.trackMenuInteraction('search_bar')}})}
if(searchClose){searchClose.addEventListener('click',()=>{searchBar.classList.remove('active')})}
if(searchInput){searchInput.addEventListener('input',(e)=>{this.currentSearchTerm=e.target.value.toLowerCase();clearTimeout(window.searchTrackingTimeout);window.searchTrackingTimeout=setTimeout(()=>{if(this.currentSearchTerm&&this.managers.analytics){this.managers.analytics.trackSearch(this.currentSearchTerm)}},1000);this.managers.products.filterProducts(this.currentSearchTerm)})}}
setupCartEventListeners(){const cartToggle=document.getElementById('cartToggle');const backButtonCart=document.getElementById('backButtonCart');if(cartToggle){cartToggle.addEventListener('click',()=>{this.managers.ui.openCartSidebar()})}
if(backButtonCart){backButtonCart.addEventListener('click',()=>{this.managers.ui.closeCartSidebar()})}
const checkoutBtnTemu=document.getElementById('checkoutBtnTemu');if(checkoutBtnTemu){checkoutBtnTemu.addEventListener('click',()=>{this.managers.cart.checkout()})}}
setupModalEventListeners(){const whyChooseBtn=document.getElementById('whyChooseBtn');const modalClose=document.getElementById('modalClose');if(whyChooseBtn){whyChooseBtn.addEventListener('click',()=>{this.openWhyChooseModal()})}
if(modalClose){modalClose.addEventListener('click',()=>{this.closeWhyChooseModal()})}
const closeProductDetails=document.getElementById('closeProductDetails');if(closeProductDetails){closeProductDetails.addEventListener('click',()=>{this.managers.ui.closeProductDetailsModal()})}
const whyChooseBtnMobile=document.querySelector('.why-choose-btn-mobile');if(whyChooseBtnMobile){whyChooseBtnMobile.addEventListener('click',(e)=>{e.preventDefault();this.closeMobileMenu();setTimeout(()=>this.openWhyChooseModal(),300)})}}
setupNavigationEventListeners(){document.querySelectorAll('.category-item').forEach(item=>{item.addEventListener('click',(e)=>{e.preventDefault();const targetId=item.getAttribute('href').substring(1);this.managers.ui.scrollToSection(targetId);document.querySelectorAll('.category-item').forEach(i=>i.classList.remove('active'));item.classList.add('active')})})}
setupGlobalEventListeners(){const overlay=document.getElementById('overlay');if(overlay){overlay.addEventListener('click',()=>{this.closeAllModals()})}
document.addEventListener('keydown',(e)=>{if(e.key==='Escape'){this.closeAllModals()}});window.addEventListener('beforeunload',()=>{if(this.managers.analytics){this.managers.analytics.trackTimeSpentOnPage(document.title)}});setInterval(()=>{if(this.managers.analytics&&document.visibilityState==='visible'){this.managers.analytics.trackEvent('Engagement','active_user','30s_interval')}},30000)}
closeAllModals(){const mobileMenu=document.getElementById('mobileMenu');const cartPage=document.getElementById('cartPage');const searchBar=document.getElementById('searchBar');const whyChooseModal=document.getElementById('whyChooseModal');const overlay=document.getElementById('overlay');mobileMenu?.classList.remove('active');cartPage?.classList.remove('active');searchBar?.classList.remove('active');whyChooseModal?.classList.remove('active');this.managers.ui.closeProductDetailsModal();const whatsappMenu=document.getElementById('whatsappMenu');if(whatsappMenu){whatsappMenu.classList.remove('active')}
overlay?.classList.remove('active');document.body.style.overflow=''}
openWhyChooseModal(){const modal=document.getElementById('whyChooseModal');const overlay=document.getElementById('overlay');if(this.managers.analytics){this.managers.analytics.trackEvent('UI','open_modal','why_choose_us')}
modal?.classList.add('active');overlay?.classList.add('active');document.body.style.overflow='hidden'}
closeWhyChooseModal(){const modal=document.getElementById('whyChooseModal');const overlay=document.getElementById('overlay');modal?.classList.remove('active');overlay?.classList.remove('active');document.body.style.overflow=''}
closeMobileMenu(){const mobileMenu=document.getElementById('mobileMenu');const overlay=document.getElementById('overlay');mobileMenu?.classList.remove('active');overlay?.classList.remove('active');document.body.style.overflow=''}}
class ProductManager{constructor(app){this.app=app}
async loadProducts(){console.log('üì• Cargando productos desde Google Sheets...');if(this.app.managers.analytics){this.app.managers.analytics.trackEvent('Products','load_start','google_sheets')}
for(const proxy of CONFIG.PROXIES){try{const sheetUrl=this.getSheetUrl();const proxyUrl=proxy+encodeURIComponent(sheetUrl);console.log(`üîß Probando proxy: ${proxy}`);const response=await this.fetchWithTimeout(proxyUrl,8000);if(response.ok){const csvText=await response.text();console.log('‚úÖ CSV obtenido correctamente');this.processProductsData(csvText);return}}catch(error){console.warn(`‚ùå Proxy fall√≥: ${error.message}`);continue}}
console.error('‚ùå Todos los proxies fallaron, usando datos locales');this.loadFallbackProducts()}
getSheetUrl(){return `https://docs.google.com/spreadsheets/d/e/${CONFIG.SHEET_ID}/pub?gid=${CONFIG.GID}&single=true&output=csv`}
async fetchWithTimeout(url,timeout=10000){return new Promise((resolve,reject)=>{const controller=new AbortController();const timeoutId=setTimeout(()=>{controller.abort();reject(new Error(`Timeout despu√©s de ${timeout}ms`))},timeout);fetch(url,{signal:controller.signal,mode:'cors'}).then(response=>{clearTimeout(timeoutId);resolve(response)}).catch(error=>{clearTimeout(timeoutId);reject(error)})})}
processProductsData(csvText){const parsedData=this.parseCSV(csvText);this.organizeProducts(parsedData);this.renderAllProducts();if(this.app.managers.analytics){this.app.managers.analytics.trackEvent('Products','load_success',`Products: ${parsedData.length}`)}}
parseCSV(csvText){const lines=csvText.split('\n').filter(line=>line.trim());if(lines.length===0)throw new Error('CSV vac√≠o');const headers=lines[0].split(',').map(h=>h.trim().toLowerCase());const products=[];for(let i=1;i<lines.length;i++){if(!lines[i].trim())continue;try{const values=this.parseCSVLine(lines[i]);const product=this.createProductFromCSV(headers,values);if(product.id&&product.name&&product.category){products.push(product)}}catch(error){console.warn(`‚ùå Error procesando l√≠nea ${i}:`,error)}}
console.log(`‚úÖ ${products.length} productos parseados correctamente`);return products}
parseCSVLine(line){const values=[];let current='';let inQuotes=!1;for(let char of line){if(char==='"'){inQuotes=!inQuotes}else if(char===','&&!inQuotes){values.push(current);current=''}else{current+=char}}
values.push(current);return values.map(v=>v.replace(/^"|"$/g,''))}
createProductFromCSV(headers,values){const product={};const propertyMap={'oldprice':'oldPrice','discountprice':'discountPrice','salescount':'salesCount','heatlevel':'heatLevel','images':'images','sizes':'sizes','varieties':'varieties','style':'style'};headers.forEach((header,index)=>{if(values[index]!==undefined&&header){let value=values[index].trim();value=this.convertValueType(header,value);const propertyName=propertyMap[header]||header;if((header==='images'||header==='sizes'||header==='varieties')&&value){value=value.split(';').map(item=>item.trim())}
product[propertyName]=value}});return product}
convertValueType(header,value){if(['price','oldprice','discountprice','abv','ibu'].includes(header)){return parseFloat(value)||0}else if(['stock','sold','salescount','id'].includes(header)){return parseInt(value)||0}else if(header==='rating'){return parseFloat(value)||4.5}else if(['active','stocklimit'].includes(header)){return value==='TRUE'||value==='true'||value==='1'}
return value}
organizeProducts(productsArray){for(const category in this.app.products){this.app.products[category]=[]}
productsArray.forEach(product=>{if(product.active==='false')return;const category=(product.category||'').toLowerCase();if(product.badge&&product.badge.toLowerCase().includes('flash')||product.oldPrice){this.app.products.flash.push(product)}
this.addToCategory(product,category)});this.processMostSoldProducts(productsArray);this.ensureMinimumProducts()}
processMostSoldProducts(productsArray){const activeProductsWithSales=productsArray.filter(product=>product.active!=='false'&&product.sold&&parseInt(product.sold)>0);const sortedBySales=activeProductsWithSales.sort((a,b)=>{const salesA=parseInt(a.sold)||0;const salesB=parseInt(b.sold)||0;return salesB-salesA});this.app.products.mostSold=sortedBySales.slice(0,4);console.log(`‚úÖ ${this.app.products.mostSold.length} productos m√°s vendidos cargados`)}
addToCategory(product,category){const categoryMap={'beers':'beers','sauces':'sauces','preserves':'preserves','combos':'combos'};const targetCategory=categoryMap[category]||'beers';this.app.products[targetCategory].push(product);if(targetCategory!=='mostSold'){this.app.products[targetCategory].push(product)}}
ensureMinimumProducts(){if(this.app.products.flash.length===0){this.app.products.beers.slice(0,4).forEach(product=>{this.app.products.flash.push({...product,oldPrice:product.price*1.3,badge:'flash'})})}
if(this.app.products.mostSold.length===0){this.app.products.mostSold=this.app.products.beers.slice(0,4).map(p=>({...p,sold:Math.floor(Math.random()*100)+50}))}else if(this.app.products.mostSold.length>4){this.app.products.mostSold=this.app.products.mostSold.slice(0,4)}}
loadFallbackProducts(){this.app.products={flash:[{id:1,name:"IPA Artesanal - 500ml",description:"Cerveza IPA con l√∫pulos americanos y notas c√≠tricas",price:1800,oldPrice:2200,image:"images/products/ipa.jpg",badge:"flash",stock:15,sold:45,rating:4.8,size:"500ml",abv:6.5,ibu:65,ingredients:"Agua, malta, l√∫pulo, levadura"}],mostSold:[{id:3,name:"Golden Ale - 500ml",description:"Cerveza rubia suave y refrescante",price:1600,image:"images/products/golden.jpg",badge:"popular",stock:25,sold:78,rating:4.7,size:"500ml",abv:5.2,ibu:25}],beers:[],sauces:[],preserves:[],combos:[]};this.renderAllProducts()}
renderAllProducts(){this.renderProductsSection('flash-products',this.app.products.flash,!0);this.renderProductsSection('most-sold-products',this.app.products.mostSold);this.renderProductsSection('beer-products',this.app.products.beers);this.renderProductsSection('sauce-products',this.app.products.sauces);this.renderProductsSection('preserve-products',this.app.products.preserves);this.renderProductsSection('combo-products',this.app.products.combos);this.updateRecommendations();this.updateProductViewers()}
renderProductsSection(containerId,productList,isFlash=!1){const container=document.getElementById(containerId);if(!container)return;if(!productList||productList.length===0){container.innerHTML=this.getEmptyProductsHTML();return}
container.innerHTML=productList.map(product=>this.createProductCard(product,isFlash)).join('');this.attachProductEventListeners(container)}
createProductCard(product,isFlash=!1){const discount=product.oldPrice?Math.round(((product.oldPrice-product.price)/product.oldPrice)*100):0;const stockPercentage=product.stock?Math.min((product.stock/50)*100,100):100;const isLowStock=product.stock&&product.stock<10;const isOutOfStock=product.stock===0;const qualifiesForFreeShipping=product.price>=CONFIG.FREE_SHIPPING_THRESHOLD;const badgesHTML=this.generateProductBadges(product,qualifiesForFreeShipping,isLowStock,isOutOfStock);return `
            <div class="product-card" data-id="${product.id}" data-category="${product.category || 'beer'}">
                <div class="product-badges">${badgesHTML}</div>
                
                <div class="product-image">
                    ${product.image ? 
                        `<img src="${product.image}" alt="${product.name}" loading="lazy" onerror="window.elOsoApp.managers.ui.handleImageError(this)">` : 
                        this.getCategoryIcon(product.category || 'beer')
                    }
                    ${product.stock && !isOutOfStock ? `<div class="stock-bar"><div class="stock-fill" style="width: ${stockPercentage}%"></div></div>` : ''}
                </div>
                
                <div class="product-info">
                    <h3 class="product-name">${product.name}</h3>
                    <p class="product-description">${product.description || 'Producto de calidad premium'}</p>
                    
                    <div class="product-pricing">
                        <span class="product-price">$${product.price.toLocaleString()}</span>
                        ${product.oldPrice ? `<span class="product-old-price">$${product.oldPrice.toLocaleString()}</span><span class="product-discount">-${discount}%</span>` : ''}
                    </div>
                    
                    ${qualifiesForFreeShipping ? this.getFreeShippingHTML() : ''}
                    
                    <div class="product-meta">
                        ${product.sold ? `<div class="product-sold"><i class="fas fa-fire"></i><span>${product.sold}+vendidos</span></div>` : ''}
                        
                        ${product.rating ? `<div class="product-rating"><i class="fas fa-star"></i><span>${product.rating}</span></div>` : ''}
                    </div>
                    
                    <div class="product-actions">
                        <button class="add-to-cart-btn" alt="" data-id="${product.id}" ${isOutOfStock ? 'disabled' : ''}>
                            <i class="fas fa-cart-plus"></i>
                            ${isOutOfStock ? 'SIN STOCK' : 'AGREGAR AL CARRITO'}
                        </button>
                        <button class="quick-buy-btn" alt="" data-id="${product.id}" ${isOutOfStock ? 'disabled' : ''}>
                            <i class="fas fa-bolt"></i>
                            COMPRAR R√ÅPIDO
                        </button>
                    </div>
                </div>
            </div>
        `}
generateProductBadges(product,qualifiesForFreeShipping,isLowStock,isOutOfStock){let badgeType=product.badge||'';if(!badgeType&&product.oldPrice)badgeType='flash';if(!badgeType&&product.sold>100)badgeType='popular';let badgesHTML='';if(badgeType){badgesHTML+=`<div class="product-badge badge-${badgeType}">${this.getBadgeText(badgeType)}</div>`}
if(qualifiesForFreeShipping){badgesHTML+=`<div class="product-badge badge-shipping">üöö ENV√çO GRATIS</div>`}
if(isLowStock&&!isOutOfStock){badgesHTML+=`<div class="product-badge badge-stock">‚ö†Ô∏è √öLTIMAS</div>`}
if(isOutOfStock){badgesHTML+=`<div class="product-badge badge-stock">üî¥ AGOTADO</div>`}
return badgesHTML}
getBadgeText(badge){const badges={'flash':'üî• FLASH','new':'üÜï NUEVO','popular':'‚≠ê POPULAR','trending':'üìà TRENDING','stock':'‚ö†Ô∏è √öLTIMAS','outofstock':'üî¥ AGOTADO','shipping':'üöö ENV√çO GRATIS'};return badges[badge]||badge.toUpperCase()}
getCategoryIcon(category){const icons={'beer':'fas fa-beer','beers':'fas fa-beer','cerveza':'fas fa-beer','cervezas':'fas fa-beer','sauce':'fas fa-pepper-hot','sauces':'fas fa-pepper-hot','salsa':'fas fa-pepper-hot','salsas':'fas fa-pepper-hot','preserve':'fas fa-jar','preserves':'fas fa-jar','conserva':'fas fa-jar','conservas':'fas fa-jar','combo':'fas fa-gift','combos':'fas fa-gift'};const normalizedCategory=(category||'').toLowerCase();const iconClass=icons[normalizedCategory]||'fas fa-beer';return `<i class="${iconClass}" style="font-size: 48px; color: #ccc;"></i>`}
getFreeShippingHTML(){return `
            <div class="free-shipping-info">
                <i class="fas fa-shipping-fast"></i>
                <span>Env√≠o gratis en Quilmes Jueves y Viernes</span>
            </div>
        `}
getEmptyProductsHTML(){return `
            <div class="loading-products">
                <i class="fas fa-box-open"></i>
                <p>No hay productos disponibles</p>
            </div>
        `}
attachProductEventListeners(container){container.querySelectorAll('.add-to-cart-btn:not(:disabled)').forEach(btn=>{btn.addEventListener('click',(e)=>{e.stopPropagation();const productId=parseInt(btn.dataset.id);this.app.addToCart(productId,btn)})});container.querySelectorAll('.quick-buy-btn').forEach(btn=>{btn.addEventListener('click',(e)=>{e.stopPropagation();const productId=parseInt(btn.dataset.id);this.quickBuyProduct(productId)})});container.querySelectorAll('.product-card').forEach(card=>{card.addEventListener('click',(e)=>{if(!e.target.closest('button')){const productId=parseInt(card.dataset.id);this.showProductDetails(productId)}})})}
quickBuyProduct(productId){const product=this.getProductById(productId);if(!product)return;if(this.app.managers.analytics){this.app.managers.analytics.trackQuickBuy(product)}
const message=`¬°Hola! Quiero comprar *${product.name}* por $${product.price.toLocaleString()}. Por favor, necesito coordinar la entrega. ¬°Gracias!`;this.app.managers.ui.openWhatsApp(message)}
showProductDetails(productId){const product=this.getProductById(productId);if(!product)return;this.app.managers.ui.showProductDetailsModal(product)}
getProductById(id){for(const category in this.app.products){const product=this.app.products[category].find(p=>p.id===id);if(product)return product}
return null}
updateRecommendations(){this.app.managers.cart.updateRecommendations()}
updateProductViewers(){this.app.managers.ui.updateProductViewers()}
filterProducts(searchTerm){if(!searchTerm){this.renderAllProducts();return}
const filteredProducts={};for(const category in this.app.products){filteredProducts[category]=this.app.products[category].filter(p=>p.name.toLowerCase().includes(searchTerm)||p.description.toLowerCase().includes(searchTerm))}
this.renderProductsSection('flash-products',filteredProducts.flash,!0);this.renderProductsSection('most-sold-products',filteredProducts.mostSold);this.renderProductsSection('beer-products',filteredProducts.beers);this.renderProductsSection('sauce-products',filteredProducts.sauces);this.renderProductsSection('preserve-products',filteredProducts.preserves);this.renderProductsSection('combo-products',filteredProducts.combos)}}
class CartManager{constructor(app){this.app=app}
addToCart(productId,button=null){const product=this.app.getProductById(productId);if(!product)return;const existingItem=this.app.cart.find(item=>item.id===productId);if(existingItem&&product.stock&&existingItem.quantity>=product.stock){this.app.managers.ui.showNotification('‚ùå No hay m√°s stock disponible','error');return}
if(existingItem){existingItem.quantity+=1}else{this.app.cart.push({...product,quantity:1})}
if(this.app.managers.analytics){this.app.managers.analytics.trackAddToCart(product,1)}
if(button){button.classList.add('added');setTimeout(()=>button.classList.remove('added'),500)}
this.app.updateCartUI();this.saveCart();this.app.managers.ui.showNotification('‚úÖ Producto agregado al carrito','success')}
removeFromCart(productId){const product=this.app.getProductById(productId);if(!product)return;const item=this.app.cart.find(item=>item.id===productId);if(item&&this.app.managers.analytics){this.app.managers.analytics.trackRemoveFromCart(product,item.quantity)}
this.app.cart=this.app.cart.filter(item=>item.id!==productId);this.app.updateCartUI();this.saveCart();this.app.managers.ui.showNotification('üóëÔ∏è Producto eliminado','info')}
updateCartQuantity(productId,change){const item=this.app.cart.find(item=>item.id===productId);if(!item)return;const newQuantity=item.quantity+change;if(newQuantity<1){this.removeFromCart(productId);return}
if(item.stock&&newQuantity>item.stock){this.app.managers.ui.showNotification('‚ùå No hay suficiente stock','error');return}
item.quantity=newQuantity;this.app.updateCartUI();this.saveCart()}
updateCartUI(){this.updateCartItems();this.updateCartSummary();this.app.managers.ui.updateShippingProgress()}
updateCartItems(){const cartItemsList=document.getElementById('cartItemsList');const cartItemsCount=document.getElementById('cartItemsCount');const checkoutItemsCount=document.getElementById('checkoutItemsCount');const cartCount=document.querySelector('.cart-count');if(cartItemsList){if(this.app.cart.length===0){cartItemsList.innerHTML=this.getEmptyCartHTML()}else{cartItemsList.innerHTML=this.app.cart.map(item=>this.createCartItemHTML(item)).join('')}}
const totalItems=this.app.cart.reduce((sum,item)=>sum+item.quantity,0);if(cartItemsCount)cartItemsCount.textContent=totalItems;if(checkoutItemsCount)checkoutItemsCount.textContent=totalItems;if(cartCount){cartCount.textContent=totalItems;cartCount.style.transform='scale(1.3)';setTimeout(()=>cartCount.style.transform='scale(1)',300)}}
createCartItemHTML(item){const displayPrice=item.discountPrice||item.price;const originalPrice=item.oldPrice||item.price;const discount=originalPrice>displayPrice?Math.round(((originalPrice-displayPrice)/originalPrice)*100):0;const variant=item.size||item.variety||'√önica variedad';const totalPrice=displayPrice*item.quantity;const totalOriginalPrice=originalPrice*item.quantity;return `
            <div class="cart-item-temu" data-id="${item.id}" data-category="${item.category || 'beer'}">
                <div class="cart-item-image-temu">
                    ${item.image ? 
                        `<img src="${item.image}" alt="${item.name}" loading="lazy" onerror="window.elOsoApp.managers.ui.handleImageError(this)">` : 
                        this.app.managers.products.getCategoryIcon(item.category || 'beer')
                    }
                </div>
                <div class="cart-item-details-temu">
                    <div class="cart-item-name-temu">${item.name}</div>
                    <div class="cart-item-variant-temu">${variant} ‚úì</div>
                    <div class="cart-item-pricing-temu">
                        <span class="cart-item-current-price-temu">$${totalPrice.toLocaleString()}</span>
                        ${discount > 0 ? `<span class="cart-item-old-price-temu">$${totalOriginalPrice.toLocaleString()}</span><span class="cart-item-discount-temu">-${discount}%</span>` : ''}
                    </div>
                    <div class="cart-item-actions-temu">
                        <div class="quantity-selector-temu">
                            <button class="quantity-btn-temu" alt="" onclick="window.elOsoApp.updateCartQuantity(${item.id}, -1)">
                                <i class="fas fa-minus"></i>
                            </button>
                            <span class="quantity-display-temu">${item.quantity}</span>
                            <button class="quantity-btn-temu" alt="" onclick="window.elOsoApp.updateCartQuantity(${item.id}, 1)" ${item.stock && item.quantity >= item.stock ? 'disabled' : ''}>
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <button class="remove-item-temu" alt="" onclick="window.elOsoApp.removeFromCart(${item.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        `}
getEmptyCartHTML(){return `
            <div class="empty-cart-temu">
                <i class="fas fa-shopping-cart"></i>
                <p>Tu carrito est√° vac√≠o</p>
                <span>Agrega productos incre√≠bles</span>
            </div>
        `}
updateCartSummary(){const summaryTotal=document.getElementById('summaryTotal');const savingsAmount=document.getElementById('savingsAmount');const{subtotal,totalSavings}=this.calculateCartTotals();if(summaryTotal)summaryTotal.textContent=`$${subtotal.toLocaleString()}`;if(savingsAmount)savingsAmount.textContent=totalSavings.toLocaleString();}
calculateCartTotals(){let subtotal=0;let totalSavings=0;this.app.cart.forEach(item=>{const displayPrice=item.discountPrice||item.price;const originalPrice=item.oldPrice||item.price;subtotal+=displayPrice*item.quantity;if(originalPrice>displayPrice){totalSavings+=(originalPrice-displayPrice)*item.quantity}});return{subtotal,totalSavings}}
updateRecommendations(){const recommendationsGrid=document.getElementById('recommendationsGrid');if(!recommendationsGrid)return;const recommendations=this.getRecommendations();if(recommendations.length===0){recommendationsGrid.innerHTML='<div class="no-recommendations">No hay recomendaciones disponibles</div>';return}
recommendationsGrid.innerHTML=recommendations.map(product=>this.createRecommendationHTML(product)).join('')}
getRecommendations(){const allProducts=[...this.app.products.beers,...this.app.products.sauces,...this.app.products.preserves,...this.app.products.combos];const cartProductIds=this.app.cart.map(item=>item.id);return allProducts.filter(product=>!cartProductIds.includes(product.id)).sort(()=>Math.random()-0.5).slice(0,4)}
createRecommendationHTML(product){const displayPrice=product.discountPrice||product.price;return `
            <div class="recommendation-item-temu" data-category="${product.category || 'beer'}">
                <div class="recommendation-image-temu">
                    ${product.image ? 
                        `<img src="${product.image}" alt="${product.name}" loading="lazy" onerror="window.elOsoApp.managers.ui.handleImageError(this)">` : 
                        this.app.managers.products.getCategoryIcon(product.category || 'beer')
                    }
                </div>
                <div class="recommendation-name-temu">${product.name}</div>
                <div class="recommendation-price-temu">$${displayPrice.toLocaleString()}</div>
                <button class="recommendation-add-btn-temu" alt="" onclick="window.elOsoApp.addToCart(${product.id})">
                    <i class="fas fa-plus"></i>
                    Agregar
                </button>
            </div>
        `}
checkout(){if(this.app.cart.length===0){this.app.managers.ui.showNotification('‚ùå Tu carrito est√° vac√≠o','error');return}
const{subtotal,totalSavings}=this.calculateCartTotals();const message=this.buildWhatsAppMessage(subtotal,totalSavings);if(this.app.managers.analytics){this.app.managers.analytics.trackBeginCheckout(this.app.cart,subtotal)}
this.submitOrderToForms(subtotal);this.app.managers.ui.openWhatsApp(message);setTimeout(()=>{this.clearCart();this.app.managers.ui.closeCartSidebar()},1000)}
buildWhatsAppMessage(subtotal,totalSavings){let message=`¬°Hola! Quiero realizar el siguiente pedido:\n\n`;this.app.cart.forEach(item=>{const displayPrice=item.discountPrice||item.price;message+=`‚Ä¢ ${item.name} x${item.quantity} - $${(displayPrice * item.quantity).toLocaleString()}\n`});message+=`\n*Resumen del pedido:*`;message+=`\nSubtotal: $${subtotal.toLocaleString()}`;if(totalSavings>0){message+=`\nAhorro: $${totalSavings.toLocaleString()}`}
message+=`\n*Total: $${subtotal.toLocaleString()}*\n\n`;message+=`Por favor, necesito coordinar la entrega. ¬°Gracias!`;return message}
async submitOrderToForms(subtotal){const orderId='ELOSO_'+Date.now()+'_'+Math.random().toString(36).substr(2,9).toUpperCase();if(this.app.managers.forms){const orderData={orderId:orderId,items:this.app.cart.map(item=>({id:item.id,name:item.name,quantity:item.quantity,price:item.discountPrice||item.price,total:(item.discountPrice||item.price)*item.quantity})),total:subtotal,phone:'A confirmar por WhatsApp',address:'A coordinar por WhatsApp',notes:`Pedido web - ${this.app.cart.length} productos`};try{await this.app.managers.forms.submitOrderToGoogleForm(orderData);if(this.app.managers.analytics){this.app.managers.analytics.trackPurchase(orderId,this.app.cart,subtotal)}}catch(error){console.error('‚ùå Error enviando pedido a Forms:',error)}}}
clearCart(){if(this.app.managers.analytics&&this.app.cart.length>0){this.app.managers.analytics.trackEvent('Ecommerce','clear_cart',`Items: ${this.app.cart.length}`)}
this.app.cart=[];this.app.updateCartUI();this.saveCart();this.app.managers.ui.showNotification('üõí Carrito vaciado','info')}
saveCart(){localStorage.setItem('elOsoCart',JSON.stringify(this.app.cart))}
loadCart(){const saved=localStorage.getItem('elOsoCart');if(saved){try{return JSON.parse(saved)}catch(e){console.error('Error loading cart:',e)}}
return[]}
calculateSubtotal(){return this.app.cart.reduce((total,item)=>{const price=item.discountPrice||item.price||0;const quantity=item.quantity||1;return total+(price*quantity)},0)}}
class UIManager{constructor(app){this.app=app;this.currentProduct=null;this.currentQuantity=1;this.setupWhatsAppMenu();this.setupMobileEventListeners()}
setupWhatsAppMenu(){const whatsappMenuToggle=document.getElementById('whatsappMenuToggle');const whatsappMenu=document.getElementById('whatsappMenu');const whatsappClose=document.getElementById('whatsappClose');if(whatsappMenuToggle){whatsappMenuToggle.addEventListener('click',(e)=>{e.stopPropagation();whatsappMenu.classList.toggle('active');if(this.app.managers.analytics){this.app.managers.analytics.trackMenuInteraction('whatsapp_menu')}})}
if(whatsappClose){whatsappClose.addEventListener('click',()=>{whatsappMenu.classList.remove('active')})}
document.querySelectorAll('.whatsapp-menu-item').forEach(item=>{item.addEventListener('click',(e)=>{const option=item.querySelector('.whatsapp-title')?.textContent||'general';if(this.app.managers.analytics){this.app.managers.analytics.trackWhatsAppClick(option)}})});document.addEventListener('click',(e)=>{if(whatsappMenu&&!whatsappMenu.contains(e.target)&&!whatsappMenuToggle?.contains(e.target)){whatsappMenu.classList.remove('active')}})}
setupMobileEventListeners(){const mobileBackBtn=document.getElementById('mobileBackBtn');if(mobileBackBtn){mobileBackBtn.addEventListener('click',()=>{this.closeProductDetailsModal()})}
const wishlistBtn=document.querySelector('.wishlist-btn');if(wishlistBtn){wishlistBtn.addEventListener('click',()=>{this.toggleWishlist()})}}
toggleWishlist(){const wishlistBtn=document.querySelector('.wishlist-btn');const isInWishlist=wishlistBtn.classList.contains('active');if(isInWishlist){wishlistBtn.classList.remove('active');wishlistBtn.innerHTML='<i class="far fa-heart"></i>';this.showNotification('üíî Eliminado de favoritos','info')}else{wishlistBtn.classList.add('active');wishlistBtn.innerHTML='<i class="fas fa-heart"></i>';this.showNotification('‚ù§Ô∏è Agregado a favoritos','success');if(this.app.managers.analytics){const productName=document.getElementById('detailsProductNameMobile')?.textContent||'Unknown Product';this.app.managers.analytics.trackEvent('Ecommerce','add_to_wishlist',productName)}}}
showProductDetailsModal(product){const modal=document.getElementById('productDetailsModal');const overlay=document.getElementById('overlay');this.currentProduct=product;this.currentQuantity=1;this.setupProductModalContent(product);modal.classList.add('active');overlay.classList.add('active');document.body.style.overflow='hidden';if(this.app.managers.analytics){this.app.managers.analytics.trackProductView(product)}}
setupProductModalContent(product){this.setupProductImagesMobile(product);this.setupProductInfoMobile(product);this.setupProductPricingMobile(product);this.setupProductSpecsMobile(product);this.setupQuantitySectionMobile(product);this.setupActionButtonsMobile(product)}
setupProductImagesMobile(product){const fixedImageContainer=document.querySelector('.fixed-image-container');const badgesContainer=document.getElementById('detailsBadgesMobile');if(fixedImageContainer){fixedImageContainer.innerHTML=''}
if(badgesContainer){badgesContainer.innerHTML=''}
if(fixedImageContainer){if(product.image){const img=document.createElement('img');img.src=product.image;img.alt=product.name;img.loading='lazy';img.onerror=()=>this.handleImageError(img);fixedImageContainer.appendChild(img)}else{const category=product.category||'beer';fixedImageContainer.innerHTML=this.app.managers.products.getCategoryIcon(category)}}
this.setupProductBadges(product,badgesContainer)}
setupProductBadges(product,container){if(!container)return;let badgeType=product.badge||'';if(!badgeType&&product.oldPrice&&product.oldPrice>product.price){badgeType='flash'}
if(!badgeType&&product.sold>100){badgeType='popular'}
if(badgeType){const badge=document.createElement('div');badge.className=`product-badge badge-${badgeType}`;badge.textContent=this.app.managers.products.getBadgeText(badgeType);container.appendChild(badge)}
if(product.stock&&product.stock<5&&product.stock>0){const stockBadge=document.createElement('div');stockBadge.className='product-badge badge-stock';stockBadge.textContent='√öLTIMAS UNIDADES';container.appendChild(stockBadge)}
if(product.stock===0){const outOfStockBadge=document.createElement('div');outOfStockBadge.className='product-badge badge-stock';outOfStockBadge.textContent='AGOTADO';container.appendChild(outOfStockBadge)}
if(product.price>=CONFIG.FREE_SHIPPING_THRESHOLD){const shippingBadge=document.createElement('div');shippingBadge.className='product-badge badge-shipping';shippingBadge.textContent='üöö ENV√çO GRATIS';container.appendChild(shippingBadge)}}
setupProductInfoMobile(product){const productNameElement=document.getElementById('detailsProductNameMobile');if(productNameElement){productNameElement.textContent=product.name}
this.setupProductRatingMobile(product);const descriptionElement=document.getElementById('detailsDescriptionMobile');if(descriptionElement){descriptionElement.textContent=product.description||'Producto de calidad premium artesanal.'}}
setupProductRatingMobile(product){const rating=product.rating||4.5;const soldCount=product.sold||Math.floor(Math.random()*100)+20;const starsContainer=document.getElementById('detailsRatingStarsMobile');const ratingText=document.getElementById('detailsRatingTextMobile');const soldElement=document.getElementById('detailsSoldMobile');if(starsContainer){starsContainer.innerHTML='';for(let i=1;i<=5;i++){const star=document.createElement('i');if(i<=Math.floor(rating)){star.className='fas fa-star star'}else if(i===Math.ceil(rating)&&!Number.isInteger(rating)){star.className='fas fa-star-half-alt star'}else{star.className='far fa-star star'}
starsContainer.appendChild(star)}}
if(ratingText)ratingText.textContent=rating.toFixed(1);if(soldElement)soldElement.textContent=`${soldCount}+ vendidos`}
setupProductPricingMobile(product){const currentPriceElement=document.getElementById('detailsCurrentPriceMobile');const oldPriceElement=document.getElementById('detailsOldPriceMobile');const discountElement=document.getElementById('detailsDiscountMobile');const priceSaveElement=document.getElementById('priceSaveMobile');if(!currentPriceElement)return;const displayPrice=product.discountPrice||product.price;currentPriceElement.textContent=`$${displayPrice.toLocaleString()}`;if(product.oldPrice&&product.oldPrice>displayPrice){const discount=Math.round(((product.oldPrice-displayPrice)/product.oldPrice)*100);const savings=product.oldPrice-displayPrice;if(oldPriceElement){oldPriceElement.textContent=`$${product.oldPrice.toLocaleString()}`;oldPriceElement.style.display='inline'}
if(discountElement){discountElement.textContent=`-${discount}%`;discountElement.style.display='inline'}
if(priceSaveElement){priceSaveElement.textContent=`Ahorras $${savings.toLocaleString()}`;priceSaveElement.style.display='block'}}else{if(oldPriceElement)oldPriceElement.style.display='none';if(discountElement)discountElement.style.display='none';if(priceSaveElement)priceSaveElement.style.display='none'}}
setupProductSpecsMobile(product){const specsContainer=document.getElementById('productSpecsMobile');if(!specsContainer)return;specsContainer.innerHTML='';const specs=this.generateProductSpecsMobile(product);specsContainer.innerHTML=specs}
generateProductSpecsMobile(product){const specs=[];const category=(product.category||'').toLowerCase();if(product.size){specs.push({label:'Tama√±o',value:product.size})}
if(category.includes('beer')||category.includes('cerveza')){if(product.abv){specs.push({label:'Alcohol',value:`${product.abv}% ABV`})}
if(product.ibu){specs.push({label:'Amargor',value:`${product.ibu} IBU`})}
if(product.style){specs.push({label:'Estilo',value:product.style})}}
if(category.includes('sauce')||category.includes('salsa')){if(product.heatLevel){specs.push({label:'Nivel de Picante',value:this.getHeatLevelDisplay(product.heatLevel)})}}
if(product.ingredients){specs.push({label:'Ingredientes',value:product.ingredients})}
if(product.stock!==undefined){if(product.stock===0){specs.push({label:'Disponibilidad',value:'Agotado'})}else if(product.stock<10){specs.push({label:'Disponibilidad',value:`Solo ${product.stock} unidades`})}else{specs.push({label:'Disponibilidad',value:'En stock'})}}
if(specs.length===0){return'<div class="no-specs">No hay especificaciones disponibles</div>'}
return specs.map(spec=>`
            <div class="spec-row-mobile">
                <div class="spec-label-mobile">${spec.label}</div>
                <div class="spec-value-mobile">${spec.value}</div>
            </div>
        `).join('')}
getHeatLevelDisplay(heatLevel){const levels={'mild':'üå∂Ô∏è Suave','medium':'üå∂Ô∏èüå∂Ô∏è Medio','hot':'üå∂Ô∏èüå∂Ô∏èüå∂Ô∏è Picante','extreme':'üå∂Ô∏èüå∂Ô∏èüå∂Ô∏èüå∂Ô∏è Extremo'};return levels[heatLevel.toLowerCase()]||heatLevel}
setupQuantitySectionMobile(product){const quantityDisplay=document.querySelector('.quantity-display-mobile');const decreaseBtn=document.querySelector('.quantity-btn-mobile.decrease');const increaseBtn=document.querySelector('.quantity-btn-mobile.increase');const stockInfo=document.getElementById('detailsStockInfoMobile');if(!quantityDisplay||!decreaseBtn||!increaseBtn||!stockInfo)return;this.currentQuantity=1;quantityDisplay.textContent=this.currentQuantity;if(product.stock!==undefined){if(product.stock===0){stockInfo.textContent='AGOTADO';stockInfo.className='stock-info-mobile stock-low';decreaseBtn.disabled=!0;increaseBtn.disabled=!0}else if(product.stock<10){stockInfo.textContent=`Solo ${product.stock} disponibles`;stockInfo.className='stock-info-mobile stock-low'}else{stockInfo.textContent='En stock';stockInfo.className='stock-info-mobile'}}else{stockInfo.textContent='Disponible';stockInfo.className='stock-info-mobile'}
decreaseBtn.onclick=()=>{if(this.currentQuantity>1){this.currentQuantity--;quantityDisplay.textContent=this.currentQuantity;decreaseBtn.disabled=this.currentQuantity<=1}};increaseBtn.onclick=()=>{if(!product.stock||this.currentQuantity<product.stock){this.currentQuantity++;quantityDisplay.textContent=this.currentQuantity;decreaseBtn.disabled=!1}else{this.showNotification('‚ùå No hay m√°s stock disponible','error')}};decreaseBtn.disabled=this.currentQuantity<=1}
setupActionButtonsMobile(product){const addToCartBtn=document.getElementById('detailsAddToCartFixed');if(!addToCartBtn)return;if(product.stock===0){addToCartBtn.disabled=!0;addToCartBtn.innerHTML='<i class="fas fa-times"></i><span>SIN STOCK</span>';return}
addToCartBtn.onclick=()=>{for(let i=0;i<this.currentQuantity;i++){this.app.addToCart(product.id)}
this.closeProductDetailsModal();this.showNotification(`‚úÖ ${product.name} agregado al carrito`,'success')};addToCartBtn.disabled=!1;addToCartBtn.innerHTML='<i class="fas fa-cart-plus"></i><span>AGREGAR AL CARRITO</span>'}
closeProductDetailsModal(){const modal=document.getElementById('productDetailsModal');const overlay=document.getElementById('overlay');modal?.classList.remove('active');overlay?.classList.remove('active');document.body.style.overflow='';this.currentProduct=null;this.currentQuantity=1}
handleImageError(img){const imageElement=img.target||img;let category='beer';const productCard=imageElement.closest('.product-card');if(productCard){category=productCard.dataset.category||'beer'}
const contextCategory=imageElement.closest('[data-category]');if(contextCategory){category=contextCategory.dataset.category||category}
imageElement.style.display='none';const iconContainer=document.createElement('div');iconContainer.className='image-error-fallback';iconContainer.style.cssText=`
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            background: #f8f8f8;
            color: #ccc;
        `;const iconHTML=this.app.managers.products.getCategoryIcon(category);iconContainer.innerHTML=iconHTML;imageElement.parentNode.appendChild(iconContainer)}
startCountdown(){const countdownElement=document.getElementById('countdown');const miniCountdown=document.getElementById('miniCountdown');if(!countdownElement)return;const countdownEndKey='elOsoCountdownEnd';let countdownEnd=localStorage.getItem(countdownEndKey);if(!countdownEnd){countdownEnd=Date.now()+(24*60*60*1000);localStorage.setItem(countdownEndKey,countdownEnd)}else{countdownEnd=parseInt(countdownEnd)}
const updateCountdown=()=>{const now=Date.now();const timeLeft=Math.max(0,countdownEnd-now);if(timeLeft<=0){countdownEnd=Date.now()+(24*60*60*1000);localStorage.setItem(countdownEndKey,countdownEnd);updateCountdown();return}
const hours=Math.floor(timeLeft/(1000*60*60));const minutes=Math.floor((timeLeft%(1000*60*60))/(1000*60));const seconds=Math.floor((timeLeft%(1000*60))/1000);if(countdownElement){const[hoursEl,minutesEl,secondsEl]=countdownElement.querySelectorAll('.countdown-number');hoursEl.textContent=hours.toString().padStart(2,'0');minutesEl.textContent=minutes.toString().padStart(2,'0');secondsEl.textContent=seconds.toString().padStart(2,'0')}
if(miniCountdown){miniCountdown.textContent=`${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`}};updateCountdown();setInterval(updateCountdown,1000)}
startShippingCountdown(){const countdownElement=document.getElementById('shippingCountdown');if(!countdownElement)return;const updateShippingCountdown=()=>{const now=new Date();const currentDay=now.getDay();const currentHour=now.getHours();let targetDate=this.calculateNextShippingDate(now,currentDay,currentHour);const timeDiff=targetDate-now;if(timeDiff<=0){countdownElement.textContent="¬°ENV√çO GRATIS DISPONIBLE AHORA!";countdownElement.style.color='#FFD700';countdownElement.style.fontWeight='700';return}
const days=Math.floor(timeDiff/(1000*60*60*24));const hours=Math.floor((timeDiff%(1000*60*60*24))/(1000*60*60));const minutes=Math.floor((timeDiff%(1000*60*60))/(1000*60));let message="";if(days>0){message=`Pr√≥ximo env√≠o gratis en: ${days}d ${hours}h`}else if(hours>0){message=`¬°ENV√çO GRATIS HOY! Termina en: ${hours}h ${minutes}m`;countdownElement.style.color='#FFD700';countdownElement.style.fontWeight='700'}else{message=`¬°ENV√çO GRATIS HOY! Termina en: ${minutes}m`;countdownElement.style.color='#FFD700';countdownElement.style.fontWeight='700'}
countdownElement.textContent=message};updateShippingCountdown();setInterval(updateShippingCountdown,60000)}
calculateNextShippingDate(now,currentDay,currentHour){let targetDate;if(CONFIG.FREE_SHIPPING_DAYS.includes(currentDay)){if(currentHour<CONFIG.FREE_SHIPPING_HOUR){targetDate=new Date(now);targetDate.setHours(CONFIG.FREE_SHIPPING_HOUR,0,0,0)}else{const daysUntilNext=(CONFIG.FREE_SHIPPING_DAYS[0]-currentDay+7)%7;targetDate=new Date(now);targetDate.setDate(now.getDate()+(daysUntilNext===0?7:daysUntilNext));targetDate.setHours(CONFIG.FREE_SHIPPING_HOUR,0,0,0)}}else{const nextShippingDay=CONFIG.FREE_SHIPPING_DAYS.find(day=>day>currentDay)||CONFIG.FREE_SHIPPING_DAYS[0];const daysUntilNext=(nextShippingDay-currentDay+7)%7;targetDate=new Date(now);targetDate.setDate(now.getDate()+daysUntilNext);targetDate.setHours(CONFIG.FREE_SHIPPING_HOUR,0,0,0)}
return targetDate}
startCompactShippingCountdown(){const countdownElement=document.getElementById('compactShippingCountdown');if(!countdownElement)return;const updateCompactShippingCountdown=()=>{const now=new Date();const currentDay=now.getDay();const currentHour=now.getHours();const targetDate=this.calculateNextShippingDate(now,currentDay,currentHour);const timeDiff=targetDate-now;if(timeDiff<=0){countdownElement.textContent="¬°HOY!";return}
const days=Math.floor(timeDiff/(1000*60*60*24));const hours=Math.floor((timeDiff%(1000*60*60*24))/(1000*60*60));const minutes=Math.floor((timeDiff%(1000*60*60))/(1000*60));let countdownText="";if(days>0){countdownText=`Pr√≥ximo: ${days}d ${hours}h`}else if(hours>0){countdownText=`Pr√≥ximo: ${hours}h ${minutes}m`}else{countdownText=`Pr√≥ximo: ${minutes}m`}
countdownElement.textContent=countdownText};updateCompactShippingCountdown();setInterval(updateCompactShippingCountdown,60000)}
updateShippingProgress(){const freeShippingThreshold=CONFIG.FREE_SHIPPING_THRESHOLD;const subtotal=this.app.managers.cart.calculateSubtotal();const remaining=Math.max(0,freeShippingThreshold-subtotal);const shippingRemaining=document.getElementById('shippingRemaining');const shippingProgressFill=document.getElementById('shippingProgressFill');if(!shippingRemaining||!shippingProgressFill)return;if(subtotal>=freeShippingThreshold){shippingRemaining.textContent='¬°Env√≠o gratis en Quilmes desbloqueado!';shippingProgressFill.style.width='100%'}else{shippingRemaining.textContent=`¬°Faltan $${remaining.toLocaleString()} para env√≠o gratis en Quilmes!`;const progress=(subtotal/freeShippingThreshold)*100;shippingProgressFill.style.width=`${progress}%`}
if(this.app.cart.length===0){shippingRemaining.textContent=`¬°Faltan $${freeShippingThreshold.toLocaleString()} para env√≠o gratis en Quilmes!`;shippingProgressFill.style.width='0%'}}
updateProductViewers(){document.querySelectorAll('.product-card').forEach(card=>{const existingBadge=card.querySelector('.viewers-badge');if(existingBadge){existingBadge.remove()}
const viewers=Math.floor(Math.random()*10)+1;const viewersBadge=`
                <div class="viewers-badge">
                    <i class="fas fa-eye"></i>
                    <span>${viewers} VISTAS</span>
                </div>
            `;const badgesContainer=card.querySelector('.product-badges');if(badgesContainer){badgesContainer.insertAdjacentHTML('beforeend',viewersBadge)}})}
openCartSidebar(){const cartPage=document.getElementById('cartPage');const overlay=document.getElementById('overlay');if(this.app.managers.analytics){this.app.managers.analytics.trackViewCart(this.app.cart,this.app.managers.cart.calculateSubtotal())}
cartPage?.classList.add('active');overlay?.classList.add('active');document.body.style.overflow='hidden';this.app.updateCartUI()}
closeCartSidebar(){const cartPage=document.getElementById('cartPage');const overlay=document.getElementById('overlay');cartPage?.classList.remove('active');overlay?.classList.remove('active');document.body.style.overflow=''}
showNotification(message,type='info'){const existingNotification=document.querySelector('.notification');if(existingNotification){existingNotification.remove()}
const notification=document.createElement('div');notification.className=`notification ${type}`;notification.innerHTML=message;notification.style.cssText=`
            position: fixed;
            top: 100px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            animation: slideInRight 0.3s ease;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        `;if(type==='success'){notification.style.background='var(--success-green)'}else if(type==='error'){notification.style.background='var(--temu-red)'}else if(type==='info'){notification.style.background='var(--primary-gold)';notification.style.color='var(--primary-black)'}
document.body.appendChild(notification);setTimeout(()=>{notification.style.animation='slideOutRight 0.3s ease';setTimeout(()=>notification.remove(),300)},3000)}
openWhatsApp(message){const encodedMessage=encodeURIComponent(message);const url=`https://wa.me/5491123495971?text=${encodedMessage}`;window.open(url,'_blank');if(this.app.managers.analytics){this.app.managers.analytics.trackEvent('Contact','whatsapp_message','checkout')}}
scrollToSection(sectionId){const section=document.getElementById(sectionId);if(section){section.scrollIntoView({behavior:'smooth'});if(this.app.managers.analytics){const categorySections=['cervezas','picantes','conservas','combos','ofertas','mas-vendidos'];if(categorySections.includes(sectionId)){this.app.managers.analytics.trackViewCategory(sectionId)}
this.app.managers.analytics.trackScrollToSection(sectionId)}
document.querySelectorAll('.category-item').forEach(item=>{item.classList.remove('active');if(item.getAttribute('href')===`#${sectionId}`){item.classList.add('active')}})}}}
class GoogleAnalyticsTracker{constructor(){this.initialized=!1;this.init()}
init(){if(typeof gtag!=='undefined'){this.initialized=!0;console.log('‚úÖ Google Analytics Tracker inicializado');gtag('event','page_view',{'page_title':document.title,'page_location':window.location.href})}else{console.warn('‚ùå gtag no est√° disponible');setTimeout(()=>this.init(),2000)}}
trackEvent(category,action,label,value=null){if(!this.initialized){console.warn('Google Analytics no est√° inicializado');return}
const eventParams={'event_category':category,'event_label':label};if(value!==null){eventParams.value=value}
gtag('event',action,eventParams);console.log(`üìä GA Event: ${category} - ${action} - ${label}`,value?`Value: ${value}`:'')}
trackProductView(product){this.trackEvent('Ecommerce','view_item',product.name,product.price);gtag('event','view_item',{'items':[{'item_id':product.id.toString(),'item_name':product.name,'category':product.category||'beer','price':product.price,'quantity':1}]})}
trackAddToCart(product,quantity=1){this.trackEvent('Ecommerce','add_to_cart',product.name,product.price*quantity);gtag('event','add_to_cart',{'currency':'ARS','value':product.price*quantity,'items':[{'item_id':product.id.toString(),'item_name':product.name,'category':product.category||'beer','price':product.price,'quantity':quantity}]})}
trackRemoveFromCart(product,quantity=1){this.trackEvent('Ecommerce','remove_from_cart',product.name,product.price*quantity)}
trackBeginCheckout(cartItems,totalValue){this.trackEvent('Ecommerce','begin_checkout',`Items: ${cartItems.length}`,totalValue);gtag('event','begin_checkout',{'currency':'ARS','value':totalValue,'items':cartItems.map(item=>({'item_id':item.id.toString(),'item_name':item.name,'category':item.category||'beer','price':item.discountPrice||item.price,'quantity':item.quantity}))})}
trackPurchase(orderId,cartItems,totalValue){this.trackEvent('Ecommerce','purchase',orderId,totalValue);gtag('event','purchase',{'transaction_id':orderId,'currency':'ARS','value':totalValue,'items':cartItems.map(item=>({'item_id':item.id.toString(),'item_name':item.name,'category':item.category||'beer','price':item.discountPrice||item.price,'quantity':item.quantity}))})}
trackProductClick(product,listName='Product Grid'){this.trackEvent('Ecommerce','select_item',product.name,product.price);gtag('event','select_item',{'item_list_name':listName,'items':[{'item_id':product.id.toString(),'item_name':product.name,'category':product.category||'beer','price':product.price,'quantity':1}]})}
trackSearch(searchTerm){this.trackEvent('Search','search',searchTerm)}
trackViewCart(cartItems,totalValue){this.trackEvent('Ecommerce','view_cart',`Items: ${cartItems.length}`,totalValue)}
trackQuickBuy(product){this.trackEvent('Ecommerce','quick_buy',product.name,product.price)}
trackScrollToSection(section){this.trackEvent('Navigation','scroll_to_section',section)}
trackViewCategory(category){this.trackEvent('Navigation','view_category',category)}
trackMenuInteraction(menuType){this.trackEvent('UI','menu_interaction',menuType)}
trackWhatsAppClick(option='general'){this.trackEvent('Contact','whatsapp_click',option)}
trackTimeSpentOnPage(page){this.trackEvent('Engagement','time_spent',page)}}
class GoogleFormsManager{constructor(){this.formUrl='https://docs.google.com/forms/u/0/d/e/1FAIpQLSfzeikLeqEpynefbJUHflddYRAxLmdoDX7FfUrSFxlgmKLYTw/formResponse';this.fieldIds={orderId:'entry.1095488305',products:'entry.20852365',total:'entry.1234569827',phone:'entry.812641126',address:'entry.777911329',status:'entry.34761081'}}
async submitOrderToGoogleForm(orderData){const formData=new FormData();formData.append(this.fieldIds.orderId,orderData.orderId);formData.append(this.fieldIds.products,this.formatProducts(orderData.items));formData.append(this.fieldIds.total,orderData.total.toString());formData.append(this.fieldIds.phone,orderData.phone||'No proporcionado');formData.append(this.fieldIds.address,orderData.address||'A confirmar');formData.append(this.fieldIds.status,'Pendiente');try{await fetch(this.formUrl,{method:'POST',mode:'no-cors',body:formData});console.log('‚úÖ Pedido enviado a Google Forms');return!0}catch(error){console.log('‚ö†Ô∏è Pedido guardado localmente (fallback)');this.saveLocalBackup(orderData);return!1}}
formatProducts(items){return items.map(item=>`${item.quantity}x ${item.name} - $${(item.discountPrice || item.price) * item.quantity}`).join('\n')}
saveLocalBackup(orderData){const backups=JSON.parse(localStorage.getItem('formBackups')||'[]');backups.push({...orderData,timestamp:new Date().toISOString(),submitted:!1});localStorage.setItem('formBackups',JSON.stringify(backups))}}
class SocialProof{constructor(){this.photos=[{image:'images/ugc/photo1.jpg',user:'@rosturmer',caption:'Acompa√±amos las tostadas'},{image:'images/ugc/photo2.jpg',user:'@adannmartinez_',caption:'Una parada t√©cnica'},{image:'images/ugc/photo3.jpg',user:'@marcebon395',caption:'Vas a compartir los trafeos cerveceros'},{image:'images/ugc/photo4.jpg',user:'@manuu.soria',caption:'De m√©xican'}];this.init()}
init(){this.loadUGCPhotos()}
loadUGCPhotos(){const grid=document.getElementById('ugcGrid');if(!grid)return;grid.innerHTML='';this.photos.forEach(photo=>{const photoElement=document.createElement('div');photoElement.className='ugc-item';photoElement.innerHTML=`
                <img src="${photo.image}" alt="${photo.caption}" loading="lazy" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex'">
                <div class="ugc-fallback" style="display: none; align-items: center; justify-content: center; width: 100%; height: 100%; background: #f8f8f8; color: #ccc;">
                    <i class="fas fa-camera" style="font-size: 2rem;"></i>
                </div>
                <div class="ugc-user">
                    <div>${photo.user}</div>
                    <div>${photo.caption}</div>
                </div>
            `;grid.appendChild(photoElement)})}}
document.addEventListener('DOMContentLoaded',function(){window.elOsoApp=new ElOsoApp();window.elOsoApp.init();window.handleImageError=(img)=>window.elOsoApp.managers.ui.handleImageError(img);window.scrollToSection=(sectionId)=>window.elOsoApp.managers.ui.scrollToSection(sectionId);window.openCartSidebar=()=>window.elOsoApp.managers.ui.openCartSidebar();window.closeCartSidebar=()=>window.elOsoApp.managers.ui.closeCartSidebar();window.addToCart=(productId,button=null)=>window.elOsoApp.addToCart(productId,button);window.removeFromCart=(productId)=>window.elOsoApp.removeFromCart(productId);window.updateCartQuantity=(productId,change)=>window.elOsoApp.updateCartQuantity(productId,change);window.showProductDetails=(productId)=>window.elOsoApp.managers.products.showProductDetails(productId);window.closeProductDetailsModal=()=>window.elOsoApp.managers.ui.closeProductDetailsModal();window.openWhyChooseModal=()=>window.elOsoApp.openWhyChooseModal();window.closeWhyChooseModal=()=>window.elOsoApp.closeWhyChooseModal();window.quickBuyProduct=(productId)=>window.elOsoApp.managers.products.quickBuyProduct(productId);window.clearCart=()=>window.elOsoApp.managers.cart.clearCart()})